[{"path":"https://alexpate30.github.io/rAURUM/LICENSE.html","id":null,"dir":"","previous_headings":"","what":"MIT License","title":"MIT License","text":"Copyright (c) 2024 rAURUM authors Permission hereby granted, free charge, person obtaining copy software associated documentation files (“Software”), deal Software without restriction, including without limitation rights use, copy, modify, merge, publish, distribute, sublicense, /sell copies Software, permit persons Software furnished , subject following conditions: copyright notice permission notice shall included copies substantial portions Software. SOFTWARE PROVIDED “”, WITHOUT WARRANTY KIND, EXPRESS IMPLIED, INCLUDING LIMITED WARRANTIES MERCHANTABILITY, FITNESS PARTICULAR PURPOSE NONINFRINGEMENT. EVENT SHALL AUTHORS COPYRIGHT HOLDERS LIABLE CLAIM, DAMAGES LIABILITY, WHETHER ACTION CONTRACT, TORT OTHERWISE, ARISING , CONNECTION SOFTWARE USE DEALINGS SOFTWARE.","code":""},{"path":"https://alexpate30.github.io/rAURUM/articles/Details-on-algorithms-for-extracting-specific-variables.html","id":"introduction","dir":"Articles","previous_headings":"","what":"Introduction","title":"Details-on-algorithms-for-extracting-specific-variables","text":"rAURUM contains number functions extract specific variables, namely: BMI: extract_BMI Cholesterol/high-density lipoprotein (HDL) ratio: extract_cholhdl_ratio Diabetes status: extract_diabetes Smoking status: extract_smoking algorithms underpinning extraction variables given section 2. summary unit measurements recorded variables given section 3.","code":""},{"path":[]},{"path":"https://alexpate30.github.io/rAURUM/articles/Details-on-algorithms-for-extracting-specific-variables.html","id":"bmi-extract_bmi","dir":"Articles","previous_headings":"Algorithms for variable extraction","what":"BMI (extract_BMI)","title":"Details-on-algorithms-for-extracting-specific-variables","text":"Extraction BMI requires user specify three codelists. One BMI scores (codelist.BMI), one height measurements (codelist.height) one weight measurements (codelist.weight). BMI, height weight measurements patient cohort interest extracted. algorithm follows: measurements must non-missing BMI measurements must within user-defined valid range. Rescale height scores metres. numunitid ∈{173,432,3202}\\\\{173, 432, 3202\\}, correspond metres, measurement assumed centimetres, height measurement divided 100 (see section 3). Rescale weight scores kg. numunitid ∈{1691,2318,2997,6265}\\\\{1691, 2318, 2997, 6265\\}, correspond stone, measurement converted kg. measurements assumed kg (see section 3). Calculate BMI every pair height weight measurements using weightheight2\\frac{weight}{height^{2}}. Remove BMI scores outside specified range. Assign observation date height weight measurement occurred first. Merge directly recorded BMI scores, BMI scores calculated height weight. Take recent BMI score within specified time period, whether directly recorded BMI score, calculated height weight. recorded date, directly recorded BMI score takes preference.","code":""},{"path":"https://alexpate30.github.io/rAURUM/articles/Details-on-algorithms-for-extracting-specific-variables.html","id":"cholesterolhdl-ratio-extract_cholhdl_ratio","dir":"Articles","previous_headings":"Algorithms for variable extraction","what":"Cholesterol/HDL ratio (extract_cholhdl_ratio)","title":"Details-on-algorithms-for-extracting-specific-variables","text":"Extraction cholesterol/HDL ratio requires user specify three codelists. One cholesterol/HDL ratio measurements (codelist.ratio), one total cholesterol measurements (codelist.chol) one HDL measurements (codelist.hdl). cholesterol/HDL, total cholesterol cholesterol/HDL measurements patient cohort interest extracted. algorithm follows: measurements must non-missing cholesterol/HDL ratio measurements must within user-defined valid range. measurements assumed correct unit measurement (see section 3). Calculate cholesterol/HDL every pair total cholesterol HDL measurements using totalcholesterolHDL\\frac{total cholesterol}{HDL}. Remove cholesterol/HDL scores outside specified range. Assign observation date total cholesterol HDL measurement occurred first. Merge directly recorded cholesterol/HDL scores, cholesterol/HDL scores calculated total cholesterol HDL. Take recent cholesterol/HDL score within specified time period, whether directly recorded cholesterol/HDL score, calculated total cholesterol HDL. recorded date, directly recorded cholesterol/HDL score takes preference.","code":""},{"path":"https://alexpate30.github.io/rAURUM/articles/Details-on-algorithms-for-extracting-specific-variables.html","id":"diabetes-status-extract_diabetes","dir":"Articles","previous_headings":"Algorithms for variable extraction","what":"Diabetes status (extract_diabetes)","title":"Details-on-algorithms-for-extracting-specific-variables","text":"Extraction diabetes status requires user specify two codelists. One type 1 diabetes (codelist.type1), another type 2 diabetes (codelist.type2). reason variable treated history type variable extracted using extract_ho often individuals generic code diabetes mellitus, used identify type 2 diabetes, also specific code type 1 diabetes mellitus. algorithm treats two mutually exclusive, assigns individuals code type 1 type 1 diabetes, type 1 diabetes. algorithm follows: Extract type 1 diabetes type 2 diabetes observations occurred prior index date. Observation dates identified using variable obsdate. individual code type 1 type 2 diabetes, assign diabetes type 1.","code":""},{"path":"https://alexpate30.github.io/rAURUM/articles/Details-on-algorithms-for-extracting-specific-variables.html","id":"smoking-status-extract_smoking","dir":"Articles","previous_headings":"Algorithms for variable extraction","what":"Smoking status (extract_smoking)","title":"Details-on-algorithms-for-extracting-specific-variables","text":"Extraction smoking status requires user specify five codelists. One non-smoker (codelist.non), one ex-smoker (codelist.ex), one light smoker (codelist.light), one moderate smoker (codelist.moderate) one heavy smoker (codelist.heavy). records identified using light, moderate heavy smoker code lists, value variable, represents number cigarettes smoker per day, used modify outputted smoking status variable. maximise number observations defined way (< 10 day light, 10 - 19 day moderate, > 19 heavy). value variable observations recorded ex-smoker often denoting number cigarettes per day individual used smoke, therefore data used alter smoking status. individuals recent record non-smoker, individual previous records indicate history smoking, smoking status altered non-smoker ex-smoker. algorithm follows: Extract 100 recent non, ex, light, moderate heavy smoker observations according user inputted code lists. Observation dates identified using variable obsdate. 1 - 9 per day = light smoker. 10 - 19 per day = moderate smoker. 19 - 100 per day = heavy smoker. 100 per day, remove observation. Define smoking status recent observation. multiple date, use severe smoking status. recent observation non-smoker, codes ex, light, moderate heavy smoker prior , change ex-smoker.","code":""},{"path":"https://alexpate30.github.io/rAURUM/articles/Details-on-algorithms-for-extracting-specific-variables.html","id":"summary-of-units-of-measurement-for-test-data","dir":"Articles","previous_headings":"","what":"Summary of units of measurement for test data","title":"Details-on-algorithms-for-extracting-specific-variables","text":"section report different units measurement test data variables may recorded . unit measurement denoted numunitid variable observation file, corresponding lookup file CPRD data. queried observation data large cohort individuals aged 18 - 85 2005 - 2020 using code lists provided within inst/codelists directory rAURUM. test data searched separately using code list, resulting unit measurements recorded 0.01% query presented. results fed programs deriving variables (see section 2). defining variable, aim convert measurements scame scale/unit measurement. example, height measurements metres converted scale recorded centimeters. However, records, unit measurement might something odd, missing, meaning unclear convert onto desired scale. observations unit measurements, exclude observations, may correct measurements mis-recorded unit measurement. Instead, extracting variables, converting relevant unit measurements, define minimum maximum value, exclude observations fit range. seen , proportion observations unclear unit measurement small (exception cholesterol/hdl ratio, special case). Unit measurements cholesterol/high-density lipoprotein ratio common ‘NA’ (78.95%). second common ‘ratio’ (12.49%) 1/1 (2.33%). confusion unit measurement likely due fact ratio unit measurement, total cholesterol high-density lipoprotein unit measurement. measurements therefore assumed unit measurement (ratio). Unit measurements total cholesterol majority unit measurements mmol/L (96.35%) NA (3.54%). observations therefore assumed recorded mmol/L. Unit measurements high-density lipoprotein majority unit measurements mmol/L (94.21%) NA (5.67%). observations therefore assumed recorded mmol/L. Unit measurements body mass index majority unit measurements kg/m2 (39.58%), kg/mA2 (1.26%) NA (58.08%). observations therefore assumed recorded kg/m2. Unit measurements weight majority unit measurements kg (98.67%) NA (1.24%). observations therefore assumed recorded kg, however also know numunitid ∈1691,2318,2997or6265\\{1691, 2318, 2997 6265}, refers stone. Observations units measurements therefore converted kg. Unit measurements height majority unit measurements cm (96.82%), m (1.7%), metres (0.02%) NA (.37%). observations numunit corresponding metres, assumed centimetres, converted metres enable estimation BMI. Unit measurements systolic blood pressure unique algorithm SBP, still present results database query variable. measurement mm/Hg.","code":"list.files(system.file(\"codelists\", package = \"rAURUM\")) #> [1] \"edh_bmi_medcodeid.csv\"           \"edh_chol_medcodeid.csv\"          #> [3] \"edh_cholhdl_ratio_medcodeid.csv\" \"edh_hdl_medcodeid.csv\"           #> [5] \"edh_sbp_medcodeid.csv\"           \"height_medcodeid.csv\"            #> [7] \"weight_medcodeid.csv\""},{"path":"https://alexpate30.github.io/rAURUM/articles/rAURUM.html","id":"introduction","dir":"Articles","previous_headings":"","what":"Introduction","title":"rAURUM: An R package to simplify the extraction and processing of CPRD Aurum data, and creating analysis-ready dataset","text":"Clinical Practice Research Datalink (CPRD) large resource Electronic Health Records UK, owned UK Medicines Healthcare products Regulatory Agency (MHRA), containing information demography, medical history, test results drug use individuals registered general practice. MHRA maintain two databases, CPRD GOLD (Herrett et al. 2015) contains data general practices using Vision computer system, CPRD Aurum (Wolf et al. 2019), contains data general practices using Egton Medical Information Systems (EMIS) computer system, EMIS Web. primary care data linked hospital data, death registration data, cancer registry data, deprivation data mental health services data, enabled NHS digital.(Padmanabhan et al. 2019) 2016, EMIS Web computer system used 4199 (56%) general practices England.(Kontopantelis et al. 2018) June 2024, CPRD Aurum contained data 47 million (16 million currently registered) individuals 1,784 (1,596 currently contributing) general practices across United Kingdom.(CPRD 2024) CPRD widely used resource. Since 2019, using PubMed library, 540 studies published contain “CPRD” title abstract. Extraction transformation CPRD data analysable format computationally demanding process requires significant amount work. Despite , pieces software available aid researchers extraction processing CPRD data.Yimer et al. (2021) rEHR (Springate et al. 2017) R package manipulating analysing electronic health record data, works creating SQLite database fixed storage device (.e. disk drive), subsequently queried extract relevant information, faster conventional statistical analysis software. rEHR designed database agnostic, contains functionality longitudinal data extraction, cutting data time-varying covariates, matching controls cases, converting units test data, creating clinical code lists. rEHR however longer maintained. works older version R (3.3.2) archived CRAN. aurumpipeline package (Health Foundation Analytics Lab 2021) contains functions clean process CPRD Aurum data, works storing data parquet files disk drive, subsequently queried extract relevant data. However, aurumpipeline available CRAN provided reproducible examples. R package drugprepr (Yimer et al. 2021) implements algorithm Pye et al. (2018) preparing drug exposure data extracted CPRD, however deal initial data extraction storing data. Given large number studies using CPRD data, limited availability software data processing, indicates large amount research time spent duplicating work others order extract CPRD data. study introduces rAURUM, R package designed assist researchers working CPRD Aurum data creating datasets ‘analysis-ready’. main problem working CPRD Aurum data size raw data. Data 47 million individuals results thousands raw .txt files, Terabytes data, can cumbersome work . particular issue R users, unfeasible read data R workspace simultaneously, R operates using physical memory (RAM). suggested Springate et al. (2017), rAURUM bypassess problem creating SQLite database can saved onto fixed storage device. SQLite database can queried data interest order build analysis-ready dataset. rAURUM simplifies process querying SQLite database functions extract variables “recent test result”, “time first event”, “history specified condition”. start discussing structure CPRD Aurum data approach taken rAURUM processing data, draws heavily work Springate et al. (2017). run worked example showcase functionality rAURUM, two main groups functions. first extract store data consistent manner. second group query data extract patient level variables. focus CPRD Aurum, opposed CPRD GOLD, given considerable drop number practices utilising Vision software last 10 years, limiting research utility CPRD GOLD database. However, package can also used manage linked secondary care (HES) ONS death data, flexible point used extract store data electronic health record, touched discussion.","code":""},{"path":[]},{"path":"https://alexpate30.github.io/rAURUM/articles/rAURUM.html","id":"structure-of-cprd-aurum-data","dir":"Articles","previous_headings":"Data Structure and Extraction Process","what":"Structure of CPRD Aurum data","title":"rAURUM: An R package to simplify the extraction and processing of CPRD Aurum data, and creating analysis-ready dataset","text":"first define terminology used throughout article. Raw data: raw data provided user CPRD. Cohort: cohort individuals meet inclusion/exclusion criteria given research question. setting, cohort ultimately vector patient id’s. Analysis-ready dataset: data frame statistical models can fitted, one row individual cohort, column variable interest, example, age cohort entry, recent BMI score prior cohort entry. longitudinal analyses, data frames can concatenated, variable indicating time point data extracted. raw data split eight different file types: Consultation, DrugIssue, Observation, Patient, Practice, Problem, Referral, Staff. data specification available : (CPRD 2022). research questions, relevant files Patient, Observation DrugIssue. Patient file contains information registration database, date death lost follow , year birth gender. file required define cohort. observation file contains medical diagnoses tests, drugissue contains information prescriptions. Medical observations identified medcodeid, whereas prescriptions identified prodcodeid. order facilitate data transfer, data commonly split CPRD numerous smaller files. different patient files denoted string set1, set2, set3 file name. Individuals patient file corresponding string (setX) files containing medical prescription data. However, one Observation DrugIssue file corresponding patient file. example, observation files patients set1, set1 file name, extra suffix 1, 2, 3, etc. true DrugIssue files. naming structure follows: aurum_allpatid_setXX_extract_patient_001.txt aurum_allpatid_setXX_extract_observation_0YY.txt aurum_allpatid_setXX_extract_drugissue_0YY.txt X∈1,2,3,...X\\{1,2,3,...} Y∈01,02,03,...Y\\{01,02,03,...}. Note prefix file names may vary (.e. ‘aurum_allpatid’ part) however expect naming convention regards ‘setXX’, file type, ‘0YY’ remain consistent. changes future, endeavour update rAURUM soon possible.","code":""},{"path":"https://alexpate30.github.io/rAURUM/articles/rAURUM.html","id":"recommended-process-for-extraction","dir":"Articles","previous_headings":"Data Structure and Extraction Process","what":"Recommended process for extraction","title":"rAURUM: An R package to simplify the extraction and processing of CPRD Aurum data, and creating analysis-ready dataset","text":"recommended process developing analysis-ready dataset follows (see Figure 1 visual representation ): Step 1: Define cohort interest applying inclusion/exclusion criteria. Step 2: Read raw data individuals cohort interest R, write data SQLite database. Step 3: Query SQLite database specific codes tests create variables individual cohort. stored .rds objects, R data analysts familiar . Step 4: Combine extracted variables analysis-ready dataset, also stored .rds object. Figure 1: Flowchart recommended data extraction process. Blue boxes denoate data files. Orange boxes denote application rAURUM functions. process can done entirely within R using rAURUM functions, without specialist understanding SQLite databases required.recommend process set , querying SQLite database computationally much quicker reading raw files R workspace querying separately. also reduces probability errors induced creating numerous loops raw data files. now move onto worked example, showcase implement process using rAURUM functions detailed Table 1. Table 1: Table rAURUM functions","code":""},{"path":[]},{"path":"https://alexpate30.github.io/rAURUM/articles/rAURUM.html","id":"step-1-defining-a-cohort","dir":"Articles","previous_headings":"Worked example for data extraction","what":"Step 1: Defining a cohort","title":"rAURUM: An R package to simplify the extraction and processing of CPRD Aurum data, and creating analysis-ready dataset","text":"provided simulated patient, observation drugissue files utilisied worked example. names files share naming convention given section 2.1, column names data match real Aurum data. Numeric variables simulated random integers 1 100, date variables date 01/01/1900 01/01/2000, gender integer 1 2, year birth integer 1900 2000. Patient id practice id assigned manually. files contained inst/aurum_data directory rAURUM. installing rAURUM, directory can accessed using command system.file(\"aurum_data\", package = \"rAURUM\"). contains data 12 fake patients, split across two patient files (set1 set2) three observation drugissue files (set1): first step analyses creating defining cohort individuals, involve working patient files. Data patient files can combined using extract_cohort function. look directory specified filepath argument, file containing “patient” file name. files read concatenated single dataset. circumstances, researchers may provided list patids meet inclusion/exclusion criteria. case, can specified patids argument (requires character vector). Suppose individuals meeting exclusion criteria patid = 1, 3, 4 6. specify: circumstances, user may need apply inclusion exclusion criteria . case, one initially create patient file individuals. cohort individuals defined applying study specific inclusion/exclusion criteria. example, individuals > 1 day valid follow aged 65+, 1st January 2000. criteria can applied solely using information available patient files. example, define individuals met inclusion criteria patid = 1, 3, 4 6. cohort defined, next step extract medical/prescription data individuals. However, also common inclusion/exclusion criteria dependent medical diagnoses prescription history. example, additional inclusion criterion, individuals must diagnosis type 2 diabetes. apply criterion reduce cohort , user must first extract medical history data cohort. case, steps outlined section 2.2 may altered : Step 1: Define cohort interest applying inclusion/exclusion criteria dependent medical history. Step 2: Read medical/prescription data cohort interest R write SQLite database. Step 2.2: Query SQLite database specific codes tests apply remaining inclusion/exclusion criteria dependent medical history. Step 2.3: [Optional] Reduce SQLite database contain data individuals final cohort. may worthwhile inclusion/exclusion criteria step 3 excluded large number individuals. mean future queries SQLite database run much quicker. Step 3: Query SQLite database specific codes tests create variables individual cohort. Step 4: Combine extracted variables analysis-ready dataset.","code":"#devtools::install_github(\"alexpate30/rAURUM\") #install.packages(\"rAURUM\") NOT YET ON CRAN library(rAURUM) #> Loading required package: data.table list.files(system.file(\"aurum_data\", package = \"rAURUM\"), pattern = \".txt\") #> [1] \"aurum_allpatid_set1_extract_drugissue_001.txt\"   #> [2] \"aurum_allpatid_set1_extract_drugissue_002.txt\"   #> [3] \"aurum_allpatid_set1_extract_drugissue_003.txt\"   #> [4] \"aurum_allpatid_set1_extract_observation_001.txt\" #> [5] \"aurum_allpatid_set1_extract_observation_002.txt\" #> [6] \"aurum_allpatid_set1_extract_observation_003.txt\" #> [7] \"aurum_allpatid_set1_extract_patient_001.txt\"     #> [8] \"aurum_allpatid_set2_extract_patient_001.txt\" pat <- extract_cohort(filepath = system.file(\"aurum_data\", package = \"rAURUM\"), patids = as.character(c(1,3,4,6))) str(pat) #> 'data.frame':    4 obs. of  12 variables: #>  $ patid         : chr  \"1\" \"3\" \"4\" \"6\" #>  $ pracid        : int  49 98 53 54 #>  $ usualgpstaffid: chr  \"6\" \"43\" \"72\" \"11\" #>  $ gender        : int  2 1 2 1 #>  $ yob           : int  1984 1930 1915 1914 #>  $ mob           : int  NA NA NA NA #>  $ emis_ddate    : Date, format: \"1976-11-21\" \"1972-06-01\" ... #>  $ regstartdate  : Date, format: \"1940-07-24\" \"1913-07-02\" ... #>  $ patienttypeid : int  58 81 10 85 #>  $ regenddate    : Date, format: \"1996-08-25\" \"1997-04-24\" ... #>  $ acceptable    : int  1 1 0 1 #>  $ cprd_ddate    : Date, format: \"1935-03-17\" \"1912-04-27\" ... pat <- extract_cohort(filepath = system.file(\"aurum_data\", package = \"rAURUM\")) str(pat) #> 'data.frame':    12 obs. of  12 variables: #>  $ patid         : chr  \"1\" \"2\" \"3\" \"4\" ... #>  $ pracid        : int  49 79 98 53 62 54 49 79 98 53 ... #>  $ usualgpstaffid: chr  \"6\" \"11\" \"43\" \"72\" ... #>  $ gender        : int  2 1 1 2 2 1 2 1 1 2 ... #>  $ yob           : int  1984 1932 1930 1915 1916 1914 1984 1932 1930 1915 ... #>  $ mob           : int  NA NA NA NA NA NA NA NA NA NA ... #>  $ emis_ddate    : Date, format: \"1976-11-21\" \"1979-02-14\" ... #>  $ regstartdate  : Date, format: \"1940-07-24\" \"1929-02-23\" ... #>  $ patienttypeid : int  58 21 81 10 45 85 58 21 81 10 ... #>  $ regenddate    : Date, format: \"1996-08-25\" \"1945-03-19\" ... #>  $ acceptable    : int  1 0 1 0 0 1 1 0 1 0 ... #>  $ cprd_ddate    : Date, format: \"1935-03-17\" \"1932-02-05\" ... pat <- subset(pat, patid %in% c(1,3,4,6))"},{"path":"https://alexpate30.github.io/rAURUM/articles/rAURUM.html","id":"step-2-reading-in-data-and-creating-an-sqlite-database","dir":"Articles","previous_headings":"Worked example for data extraction","what":"Step 2: Reading in data and creating an SQLite database","title":"rAURUM: An R package to simplify the extraction and processing of CPRD Aurum data, and creating analysis-ready dataset","text":"Data individuals cohort interest extracted .txt files put SQLite database. SQLite database stored fixed storage device can queried defining analysis-ready dataset.","code":""},{"path":"https://alexpate30.github.io/rAURUM/articles/rAURUM.html","id":"add-individual-files-to-sqlite-database-using-add_to_database","dir":"Articles","previous_headings":"Worked example for data extraction > Step 2: Reading in data and creating an SQLite database","what":"Add individual files to SQLite database using add_to_database","title":"rAURUM: An R package to simplify the extraction and processing of CPRD Aurum data, and creating analysis-ready dataset","text":"function add_to_database can used add individual files SQLite database. Start defining connecting SQLite database. article create temporary database, practice permanent storage location. Specifically, tempfile(\"temp.sqlite\") replaced desired file path SQLite database name. Next, add medical diagnoses data observation files database using add_to_database function. simulated raw data provided rAURUM can accessed using system.file function. vector patient id’s defines cohort defined subset.patids argument. data patid’s matching argument added SQLite database. filetype argument select appropriate function reading .txt files, also defines name table SQLite database files added . Note first file, overwrite = TRUE specified create new table. second third file, append = TRUE specified append existing table. can query database, selecting rows observation table, printing first 3. details query SQLite database within R available documentation R package RSQLite (Müller et al. 2024). Note reading raw data R, dates converted date formats, underlying numeric value day 0 01/01/1970. saved SQLite database, underlying numeric values saved, hence dates now appearing numeric values. Next, prescription data drugissue files added table called drugissue. single SQLite database may contain one table, data added different table within SQLite database. table can queried, selecting rows drugissue table, printing first 3. Listing tables SQLite database shows now two, named observation drugissue. add_to_database function allows specification filetype = c(\"observation\", \"drugissue\", \"referral\", \"problem\", \"consultation\", \"hes_primary\",\"death\"), corresponding specific function reading corresponding .txt files correct formatting. \"hes_primary\" options correspond primary diagnoses file linked HES APC data. \"death\" file corresponds death file linked ONS data. wanting add files SQLite database, user defined function reading raw .txt file can specified extract.txt.func, table name can specified tablename. allows user add .txt file SQLite database. Finally, manually adding files manner, good practice close connection SQLite database finished.","code":"aurum_extract <- connect_database(tempfile(\"temp.sqlite\")) add_to_database(filepath = system.file(\"aurum_data\", \"aurum_allpatid_set1_extract_observation_001.txt\", package = \"rAURUM\"),                  filetype = \"observation\", subset.patids = c(1,3,4,6), db = aurum_extract, overwrite = TRUE) add_to_database(filepath = system.file(\"aurum_data\", \"aurum_allpatid_set1_extract_observation_001.txt\", package = \"rAURUM\"),                  filetype = \"observation\", subset.patids = c(1,3,4,6), db = aurum_extract, append = TRUE) add_to_database(filepath = system.file(\"aurum_data\", \"aurum_allpatid_set1_extract_observation_001.txt\", package = \"rAURUM\"),                  filetype = \"observation\", subset.patids = c(1,3,4,6), db = aurum_extract, append = TRUE) RSQLite::dbGetQuery(aurum_extract, 'SELECT * FROM observation', n = 3) #>   patid consid pracid obsid obsdate enterdate staffid parentobsid #> 1     1     33      1   100  -15931      -994      79          95 #> 2     1     66      1    46  -13782    -15232      34          17 #> 3     1     41      1    53  -20002      8845      35          79 #>           medcodeid value numunitid obstypeid numrangelow numrangehigh #> 1   498521000006119    48        16        20          28           86 #> 2         401539014    22         1         2          27            8 #> 3 13483031000006114    17        78        13          87           41 #>   probobsid #> 1        54 #> 2        35 #> 3        74 add_to_database(filepath = system.file(\"aurum_data\", \"aurum_allpatid_set1_extract_drugissue_001.txt\", package = \"rAURUM\"),                  filetype = \"drugissue\", subset.patids = c(1,3,4,6), db = aurum_extract, overwrite = TRUE) add_to_database(filepath = system.file(\"aurum_data\", \"aurum_allpatid_set1_extract_drugissue_001.txt\", package = \"rAURUM\"),                  filetype = \"drugissue\", subset.patids = c(1,3,4,6), db = aurum_extract, append = TRUE) add_to_database(filepath = system.file(\"aurum_data\", \"aurum_allpatid_set1_extract_drugissue_001.txt\", package = \"rAURUM\"),                  filetype = \"drugissue\", subset.patids = c(1,3,4,6), db = aurum_extract, append = TRUE) RSQLite::dbGetQuery(aurum_extract, 'SELECT * FROM drugissue', n = 3) #>   patid issueid pracid probobsid drugrecid issuedate enterdate staffid #> 1     1      93      1        88        83    -16118     -1013      98 #> 2     1      93      1        55        59    -13322    -12900      88 #> 3     1      16      1        22        82     -8677     -3543      50 #>         prodcodeid dosageid quantity quantunitid duration estnhscost quanunitid #> 1 3092241000033113       58       18          33       27         12          6 #> 2   92041000033111       62       93          83       59         11         25 #> 3  971241000033111       87       43          83       88         65         92 RSQLite::dbListTables(aurum_extract) #> [1] \"drugissue\"   \"observation\" RSQLite::dbDisconnect(aurum_extract)"},{"path":"https://alexpate30.github.io/rAURUM/articles/rAURUM.html","id":"add-all-relevant-files-to-sqlite-database-using-cprd_extract","dir":"Articles","previous_headings":"Worked example for data extraction > Step 2: Reading in data and creating an SQLite database","what":"Add all relevant files to SQLite database using cprd_extract","title":"rAURUM: An R package to simplify the extraction and processing of CPRD Aurum data, and creating analysis-ready dataset","text":"practice, high number files add SQLite database adding one using add_to_database cumbersome. now repeat extraction using cprd_extract function, wrapper add_to_database, add files specified directory contain string matching specified file type. Start creating connection new database: use cprd_extract add observation files SQLite database. directory containing files specified using filepath. read add files text string specified filetype, takes values c(\"observation\", \"drugissue\", \"referral\", \"problem\", \"consultation\"). query first three rows database, note previously. process repeated drugissue files. string match , function read raw data, name table SQLite database, can altered using str.match, extract.txt.func tablename arguments respectively. Note function may run considerable period time working entire CPRD AURUM database, therefore recommended run interactively. creation SQLite database may time consuming, subsequent queries far efficient, short term pain long term gain.","code":"aurum_extract <- connect_database(tempfile(\"temp.sqlite\")) ### Extract data cprd_extract(db = aurum_extract,               filepath = system.file(\"aurum_data\", package = \"rAURUM\"),               filetype = \"observation\", subset.patids = c(1,3,4,6), use.set = FALSE) #>   |                                                                              |                                                                      |   0%[1] \"Adding /home/runner/work/_temp/Library/rAURUM/aurum_data/aurum_allpatid_set1_extract_observation_001.txt 2024-08-02 16:56:31.35815\" #>   |                                                                              |=======================                                               |  33%[1] \"Adding /home/runner/work/_temp/Library/rAURUM/aurum_data/aurum_allpatid_set1_extract_observation_002.txt 2024-08-02 16:56:31.374418\" #>   |                                                                              |===============================================                       |  67%[1] \"Adding /home/runner/work/_temp/Library/rAURUM/aurum_data/aurum_allpatid_set1_extract_observation_003.txt 2024-08-02 16:56:31.385725\" #>   |                                                                              |======================================================================| 100%  ### Query first three rows RSQLite::dbGetQuery(aurum_extract, 'SELECT * FROM observation', n = 3) #>   patid consid pracid obsid obsdate enterdate staffid parentobsid #> 1     1     33      1   100  -15931      -994      79          95 #> 2     1     66      1    46  -13782    -15232      34          17 #> 3     1     41      1    53  -20002      8845      35          79 #>           medcodeid value numunitid obstypeid numrangelow numrangehigh #> 1   498521000006119    48        16        20          28           86 #> 2         401539014    22         1         2          27            8 #> 3 13483031000006114    17        78        13          87           41 #>   probobsid #> 1        54 #> 2        35 #> 3        74 ### Extract data cprd_extract(db = aurum_extract,               filepath = system.file(\"aurum_data\", package = \"rAURUM\"),               filetype = \"drugissue\", subset.patids = c(1,3,4,6), use.set = FALSE) #>   |                                                                              |                                                                      |   0%[1] \"Adding /home/runner/work/_temp/Library/rAURUM/aurum_data/aurum_allpatid_set1_extract_drugissue_001.txt 2024-08-02 16:56:31.465777\" #>   |                                                                              |=======================                                               |  33%[1] \"Adding /home/runner/work/_temp/Library/rAURUM/aurum_data/aurum_allpatid_set1_extract_drugissue_002.txt 2024-08-02 16:56:31.481179\" #>   |                                                                              |===============================================                       |  67%[1] \"Adding /home/runner/work/_temp/Library/rAURUM/aurum_data/aurum_allpatid_set1_extract_drugissue_003.txt 2024-08-02 16:56:31.492269\" #>   |                                                                              |======================================================================| 100%  ### List tables RSQLite::dbListTables(aurum_extract) #> [1] \"drugissue\"   \"observation\"  ### Query first three rows RSQLite::dbGetQuery(aurum_extract, 'SELECT * FROM drugissue', n = 3) #>   patid issueid pracid probobsid drugrecid issuedate enterdate staffid #> 1     1      93      1        88        83    -16118     -1013      98 #> 2     1      93      1        55        59    -13322    -12900      88 #> 3     1      16      1        22        82     -8677     -3543      50 #>         prodcodeid dosageid quantity quantunitid duration estnhscost quanunitid #> 1 3092241000033113       58       18          33       27         12          6 #> 2   92041000033111       62       93          83       59         11         25 #> 3  971241000033111       87       43          83       88         65         92  ### Disconnect RSQLite::dbDisconnect(aurum_extract)"},{"path":"https://alexpate30.github.io/rAURUM/articles/rAURUM.html","id":"add-all-relevant-files-to-sqlite-database-in-a-computationally-efficient-manner-using-the-set-functionality-","dir":"Articles","previous_headings":"Worked example for data extraction > Step 2: Reading in data and creating an SQLite database","what":"Add all relevant files to SQLite database in a computationally efficient manner using the set functionality.","title":"rAURUM: An R package to simplify the extraction and processing of CPRD Aurum data, and creating analysis-ready dataset","text":"number patients cohort large (example millions, tens millions), add_to_database function may perform slowly. observation file added SQLite database, add_to_database checks see whether patid contained vector subset.patids (vector length 20,000,000 case). can utilise structure CPRD AURUM data speed process. data set naming convention (see section 2.1), know need search patids subset.patids, corresponding patient file. example, reading file aurum_allpatid_set1_extract_observation_00Y.txt (Y), need search whether patid vector patids subset.patid, also aurum_allpatid_set1_extract_patient_001.txt, much smaller vector. can reduce time add_to_database takes run hours minutes. running cprd_extract hundreds files, reduce months computation time days. achieve , subset.patids object data frame two required columns. first column patid, second set, reporting corresponding value set patient belongs . first step therefore create patient file, extra variable set, number following text string set patient file containing data patient. reading patient files create cohort, can done specifying set = TRUE. example, individuals cohort come file string set1, therefore variable individuals cohort, however case practice. patient file read previously, addition set column. file can reduced just patid set columsn, used input subset.patids running add_to_database cprd_extract functions. extracting data observation files set1 name, search patient id’s set == 1 data.frame provided subset.patids. Note difference compared previously extracted SQLite databases. computational gains applying subsetting manner realised example. close connection, now move onto querying database extract variables creating analysis-ready dataset.","code":"pat <- extract_cohort(filepath = system.file(\"aurum_data\", package = \"rAURUM\"), patids = as.character(c(1,3,4,6)), set = TRUE) str(pat) #> 'data.frame':    4 obs. of  13 variables: #>  $ patid         : chr  \"1\" \"3\" \"4\" \"6\" #>  $ pracid        : int  49 98 53 54 #>  $ usualgpstaffid: chr  \"6\" \"43\" \"72\" \"11\" #>  $ gender        : int  2 1 2 1 #>  $ yob           : int  1984 1930 1915 1914 #>  $ mob           : int  NA NA NA NA #>  $ emis_ddate    : Date, format: \"1976-11-21\" \"1972-06-01\" ... #>  $ regstartdate  : Date, format: \"1940-07-24\" \"1913-07-02\" ... #>  $ patienttypeid : int  58 81 10 85 #>  $ regenddate    : Date, format: \"1996-08-25\" \"1997-04-24\" ... #>  $ acceptable    : int  1 1 0 1 #>  $ cprd_ddate    : Date, format: \"1935-03-17\" \"1912-04-27\" ... #>  $ set           : num  1 1 1 1 ### Create connection to SQLite database aurum_extract <- connect_database(tempfile(\"temp.sqlite\"))  ### Add observation files cprd_extract(db = aurum_extract,               filepath = system.file(\"aurum_data\", package = \"rAURUM\"),               filetype = \"observation\",               subset.patids = pat,               use.set = TRUE) #>   |                                                                              |                                                                      |   0%[1] \"Adding /home/runner/work/_temp/Library/rAURUM/aurum_data/aurum_allpatid_set1_extract_observation_001.txt 2024-08-02 16:56:31.651293\" #>   |                                                                              |=======================                                               |  33%[1] \"Adding /home/runner/work/_temp/Library/rAURUM/aurum_data/aurum_allpatid_set1_extract_observation_002.txt 2024-08-02 16:56:31.66422\" #>   |                                                                              |===============================================                       |  67%[1] \"Adding /home/runner/work/_temp/Library/rAURUM/aurum_data/aurum_allpatid_set1_extract_observation_003.txt 2024-08-02 16:56:31.675544\" #>   |                                                                              |======================================================================| 100%  ### Add drugissue files cprd_extract(db = aurum_extract,               filepath = system.file(\"aurum_data\", package = \"rAURUM\"),               filetype = \"drugissue\",               subset.patids = pat,               use.set = TRUE) #>   |                                                                              |                                                                      |   0%[1] \"Adding /home/runner/work/_temp/Library/rAURUM/aurum_data/aurum_allpatid_set1_extract_drugissue_001.txt 2024-08-02 16:56:31.69073\" #>   |                                                                              |=======================                                               |  33%[1] \"Adding /home/runner/work/_temp/Library/rAURUM/aurum_data/aurum_allpatid_set1_extract_drugissue_002.txt 2024-08-02 16:56:31.703103\" #>   |                                                                              |===============================================                       |  67%[1] \"Adding /home/runner/work/_temp/Library/rAURUM/aurum_data/aurum_allpatid_set1_extract_drugissue_003.txt 2024-08-02 16:56:31.71433\" #>   |                                                                              |======================================================================| 100%  ### Query first three rows of each table RSQLite::dbGetQuery(aurum_extract, 'SELECT * FROM observation', n = 3) #>   patid consid pracid obsid obsdate enterdate staffid parentobsid #> 1     1     33      1   100  -15931      -994      79          95 #> 2     1     66      1    46  -13782    -15232      34          17 #> 3     1     41      1    53  -20002      8845      35          79 #>           medcodeid value numunitid obstypeid numrangelow numrangehigh #> 1   498521000006119    48        16        20          28           86 #> 2         401539014    22         1         2          27            8 #> 3 13483031000006114    17        78        13          87           41 #>   probobsid #> 1        54 #> 2        35 #> 3        74 RSQLite::dbGetQuery(aurum_extract, 'SELECT * FROM drugissue', n = 3) #>   patid issueid pracid probobsid drugrecid issuedate enterdate staffid #> 1     1      93      1        88        83    -16118     -1013      98 #> 2     1      93      1        55        59    -13322    -12900      88 #> 3     1      16      1        22        82     -8677     -3543      50 #>         prodcodeid dosageid quantity quantunitid duration estnhscost quanunitid #> 1 3092241000033113       58       18          33       27         12          6 #> 2   92041000033111       62       93          83       59         11         25 #> 3  971241000033111       87       43          83       88         65         92"},{"path":"https://alexpate30.github.io/rAURUM/articles/rAURUM.html","id":"step-3-querying-the-sqlite-database-to-extract-variables","dir":"Articles","previous_headings":"Worked example for data extraction","what":"Step 3: Querying the SQLite database to extract variables","title":"rAURUM: An R package to simplify the extraction and processing of CPRD Aurum data, and creating analysis-ready dataset","text":"data extracted stored SQLite database, can now queried create variables interest. normal process extracting variables electronic health records create code lists, group codes denote condition. database queried observations medical codes matching code list. variable defined based query. Whether binary variable, indicating whether individual record given code, recent test result given code, something much complex. CPRD Aurum, medical diagnoses tests identified observation file using medcodeids, prescription data identified drugissue file using prodcodeids. Creation code lists important step data extraction, refer elsewhere details best practice developing code lists, limitations working code lists (Williams et al. 2019, 2017; Watson et al. 2017; Gulliford et al. 2009; Matthewman et al. 2024). functions section split three groups: Functions extracting common variable types. Functions extracting specific variables Functions database queries custom variable extraction","code":""},{"path":"https://alexpate30.github.io/rAURUM/articles/rAURUM.html","id":"functions-for-extracting-common-variable-types","dir":"Articles","previous_headings":"Worked example for data extraction > Step 3: Querying the SQLite database to extract variables","what":"Functions for extracting common variable types","title":"rAURUM: An R package to simplify the extraction and processing of CPRD Aurum data, and creating analysis-ready dataset","text":"functions extract three common variable types, history condition/edication prior index date (extract_ho), time first occurence medical event/medication use index date (extract_time_until), recent test result given time frame relative index date (extract_test_recent). first, extract_ho, extracts binary variable based whether individual specified code recorded prior index date. can applied search history medical diagnoses prescriptions. index date ust variable cohort dataset, specified indexdt argument. second extract_time_until, defines time--event/survival variable. two components, time first record specified code censoring, indicator whether event observed censored. derive variable type cohort must also contain time censoring variable, can specified censdt. third extract_test_recent, extract recent test result given time frame. number days index date search results specified time.post time.prev respectively. Test results identified observation file, using code lists. Lower upper bounds can also specified extracted data lower.bound upper.bound. Variations functions also available, extract_test_data return test data within specified time value range, extract_test_data_var returns standard deviation test data within specified time value range. variables interest extracted, can merged analysis-ready dataset (step 4).","code":"### Define codelist codelist <- \"187341000000114\"  ### Add an index date to cohort pat$fup_start <- as.Date(\"01/01/2020\", format = \"%d/%m/%Y\")  ### Extract a history of type variable using extract_ho ho <- extract_ho(cohort = pat,                   codelist.vector = codelist,                   indexdt = \"fup_start\",                   db.open = aurum_extract,                   tab = \"observation\",                  return.output = TRUE) str(ho) #> 'data.frame':    4 obs. of  2 variables: #>  $ patid: chr  \"1\" \"3\" \"4\" \"6\" #>  $ ho   : int  1 0 0 1 ### Add an censoring date to cohort pat$fup_end <- as.Date(\"01/01/2024\", format = \"%d/%m/%Y\")  ### Extract a time until variable using extract_time_until time_until <- extract_time_until(cohort = pat,                                   codelist.vector = codelist,                                   indexdt = \"fup_start\",                                   censdt = \"fup_end\",                                  db.open = aurum_extract,                                   tab = \"observation\",                                  return.output = TRUE) str(time_until) #> 'data.frame':    4 obs. of  3 variables: #>  $ patid        : chr  \"1\" \"3\" \"4\" \"6\" #>  $ var_time     : num  1461 1461 1461 1461 #>  $ var_indicator: num  0 0 0 0 ### Extract test data using extract_test_recent test_data <- extract_test_recent(cohort = pat,                                 codelist.vector = codelist,                                 indexdt = \"fup_start\",                                 db.open = aurum_extract,                                time.post = 0,                                time.prev = Inf,                                return.output = TRUE) str(test_data) #> 'data.frame':    4 obs. of  3 variables: #>  $ patid    : chr  \"1\" \"3\" \"4\" \"6\" #>  $ value    : num  84 NA NA 28 #>  $ numunitid: int  79 NA NA 20 ### Recursive merge analysis.ready.pat <- Reduce(function(df1, df2) merge(df1, df2, by = \"patid\", all.x = TRUE), list(pat[,c(\"patid\", \"gender\", \"yob\")], ho, time_until, test_data))  analysis.ready.pat #>   patid gender  yob ho var_time var_indicator value numunitid #> 1     1      2 1984  1     1461             0    84        79 #> 2     3      1 1930  0     1461             0    NA        NA #> 3     4      2 1915  0     1461             0    NA        NA #> 4     6      1 1914  1     1461             0    28        20"},{"path":"https://alexpate30.github.io/rAURUM/articles/rAURUM.html","id":"functions-for-extracting-specific-variables","dir":"Articles","previous_headings":"Worked example for data extraction > Step 3: Querying the SQLite database to extract variables","what":"Functions for extracting specific variables","title":"rAURUM: An R package to simplify the extraction and processing of CPRD Aurum data, and creating analysis-ready dataset","text":"also number functions can used extract specific variables: extract_bmi: Derives BMI scores. Requires specification codelist BMI, height, weight separately. extract_cholhdl_ratio: Derives total cholesterol/high-density lipoprotein ratio. Requires specification separate codelists total cholesterol/high-density lipoprotein ratio, total cholesterol, high-density lipoproteins separately. extract_diabetes: Derives categorical variable history type 1 diabetes, history type 2 diabetes history diabetes. Requires specification separate codelists type 1 type 2 diabetes. extract_smoking: Derives categorical variable smoking status. Requires specification seperate codelists non-smoker, ex-smoker, light smoker, moderate smoker heavy smoker. recent smoking status non-smoker, historical codes indicate smoking, individual classified ex-smoker. deemed variables required custom functions definitions fit variable types section 3.3.1. case, number steps taken order clean manipulate data order get desired output. example, height measurements recorded centimeters converted metres order calculate BMI scores. done use numunitid variable observation file. smoking status, individuals recent medical observation recorded non-smoker, medical record shows previous smoking, recent record changed ex-smoker. steps cleaning data extracting variables provided vignette titled Details--algorithms--extracting-specific-variables. However, important state, correct way define variable may change study study. Therefore using functions extract variables, encourage taking time ensure way variable extracted matches definition ones study.","code":""},{"path":"https://alexpate30.github.io/rAURUM/articles/rAURUM.html","id":"functions-for-database-queries-and-custom-variable-extraction","dir":"Articles","previous_headings":"Worked example for data extraction > Step 3: Querying the SQLite database to extract variables","what":"Functions for database queries and custom variable extraction","title":"rAURUM: An R package to simplify the extraction and processing of CPRD Aurum data, and creating analysis-ready dataset","text":"functions utilised internally functions sections 3.3.1 3.3.2. provided easily enable package users write functions extracting variables covered previous two sections. db_query function query SQLite database observations medcodeid prodcodeid specified codelist. example, can query observation table codes medcodeid 187341000000114. combine_query_boolean function assess whether individual specified cohort (pat) observation queried data (obtained using db_query) within specified time frame index date, returning 0/1 vector. cohort must contain variable called indexdt containing index date. function useful defining ‘history ’ type variables, want know record given condition prior index date. combine_query function merge cohort queried data return specified number observations (numobs) within specified time frame index date. useful extracting test data requiring access values tests, specifying variables require > 1 observation within certain time frame (.e. two prescriptions within month prior index date). queries observation table, query type can specified \"med\" \"test\". Inputting query.type = \"med\" just return date observations medcodeid. query.type = \"test\", value relevant information also returned, NA values removed (although can altered argument value.na.rm). close connection database. query drugissue table, query.type = \"drugissue\" specified, date observations prodcodeid returned. functions section little processing extracted data, manipulation required order define variables.","code":"db.query <- db_query(db.open = aurum_extract,                      tab =\"observation\",                      codelist.vector = \"187341000000114\")  db.query #>     patid consid pracid  obsid obsdate enterdate staffid parentobsid #>    <char> <char>  <int> <char>   <num>     <num>  <char>      <char> #> 1:      1     42      1     81   -5373      4302      85          35 #> 2:      6     40      1     41  -14727     -6929      98          80 #>          medcodeid value numunitid obstypeid numrangelow numrangehigh probobsid #>             <char> <num>     <int>     <int>       <num>        <num>    <char> #> 1: 187341000000114    84        79        67          24           22         5 #> 2: 187341000000114    28        20         5          41           97        92 ### Add an index date to pat pat$indexdt <- as.Date(\"01/01/2020\", format = \"%d/%m/%Y\")  ### Combine query with cohort creating a boolean variable denoting 'history of' combine.query.boolean <- combine_query_boolean(cohort = pat,                                                db.query = db.query,                                                query.type = \"observation\")    combine.query.boolean #> [1] 1 0 0 1 ### Combine query with cohort retaining most recent three records combine.query <- combine_query(cohort = pat,                                db.query = db.query,                                query.type = \"med\",                                numobs = 3)    combine.query #>     patid       medcodeid obsdate #>    <char>          <char>   <num> #> 1:      1 187341000000114   -5373 #> 2:      6 187341000000114  -14727 ### Extract a history of type variable using extract_ho combine.query <- combine_query(cohort = pat,                                db.query = db.query,                                query.type = \"test\",                                numobs = 3)    combine.query #>     patid       medcodeid obsdate value numunitid numrangelow numrangehigh #>    <char>          <char>   <num> <num>     <int>       <num>        <num> #> 1:      1 187341000000114   -5373    84        79          24           22 #> 2:      6 187341000000114  -14727    28        20          41           97  ### Disconnect RSQLite::dbDisconnect(aurum_extract)"},{"path":"https://alexpate30.github.io/rAURUM/articles/rAURUM.html","id":"saving-extracted-variables-directly-to-a-disk-drive-and-utilising-raurums-suggested-directory-system","dir":"Articles","previous_headings":"Worked example for data extraction > Step 3: Querying the SQLite database to extract variables","what":"Saving extracted variables directly to a disk drive, and utilising rAURUMs suggested directory system","title":"rAURUM: An R package to simplify the extraction and processing of CPRD Aurum data, and creating analysis-ready dataset","text":"far extracted variables (using functions section 3.3.1 3.3.2) read R workspace specifying return.output = TRUE. working large cohorts may preferable save output directly onto disk drive, specifying .save.disk = TRUE. file path save output can specified manually .filepath argument. However, argument left NULL, rAURUM attempt save extracted variable directory “data/extraction/” relative working directory. name file dependent variable name specified argument varname. can convenient way save output directly disk without repeatedly specify file paths file names. similar functionality specifying codelists. Codelists can specified two ways. first read codelist R character vector specify argument codelist.vector, done previous examples. Alternatively, codelists stored disk drive can referred codelist argument many rAURUM functions, requires specific underlying directory structure. codelist disk drive must stored directory called “codelists/analysis/” relative working directory. codelist must .csv file, contain column medcodeid, prodcodeid ICD10 depending table queried. input argument codelist just character string name files (excluding suffix ‘.csv’). codelist.vector argument take precedence codelist argument specified. Finally, similar functionality accessing SQLite database internally, rather 1) open connection, 2) use input functions, 3) remember close connection. Instead, SQLite database stored directory “data/sql/” relative working directory, SQLite database can referred name (character string) argument db. connection SQLite datbase opened internally within function call, SQLite database queried, connection closed. Alternatively, SQLite database stored anywhere disk drive can accessed specifying full filepath (character string) argument db.filepath. workflow advantageous avoids hard file paths beneficial wanting move code onto another computer system. Furthermore, codelists SQLite database created stored appropriate folders, can simply referred name, resulting easier workflow. function create_directory_system() create directory system required use rAURUM way. avoid repetition previous section, showcased just using extract_ho function. sake example, start setting working directory directory called inst/example within rAURUM. maintain new working directory across multiple R markdown code chunks, use knitr::opts_knit$set. follow section, user simply set working directory usual using setwd(). Next, create_directory_system() function can used generate required directory structure: SQLite database called “mydb.sqlite” created “data/sql” directory, using data previous examples: Finally, code list called mylist.csv created saved codelists/analysis/ directory. mydb.sqlite database can now queried create ‘history ’ type variable using codelist mylist.csv, output saved directly onto disk drive. Note order run extract_ho , connection SQLite database need created, codelist need R workspace, output function. Instead extracted variable saved onto disk drive .rds file, can read using:","code":"create_directory_system() #> [1] \"The working directory is /home/runner/work/_temp/Library/rAURUM/example\" ## Open connection aurum_extract <- connect_database(\"data/sql/mydb.sqlite\")  ## Add data to SQLite database using cprd_extract cprd_extract(db = aurum_extract,              filepath = system.file(\"aurum_data\", package = \"rAURUM\"),              filetype = \"observation\", use.set = FALSE) #>   |                                                                              |                                                                      |   0%[1] \"Adding /home/runner/work/_temp/Library/rAURUM/aurum_data/aurum_allpatid_set1_extract_observation_001.txt 2024-08-02 16:56:32.774732\" #>   |                                                                              |=======================                                               |  33%[1] \"Adding /home/runner/work/_temp/Library/rAURUM/aurum_data/aurum_allpatid_set1_extract_observation_002.txt 2024-08-02 16:56:32.787129\" #>   |                                                                              |===============================================                       |  67%[1] \"Adding /home/runner/work/_temp/Library/rAURUM/aurum_data/aurum_allpatid_set1_extract_observation_003.txt 2024-08-02 16:56:32.79789\" #>   |                                                                              |======================================================================| 100%  ## Disconnect RSQLite::dbDisconnect(aurum_extract) ### Define codelist codelist <- data.frame(medcodeid = \"187341000000114\")  ### Save codelist write.csv(codelist, \"codelists/analysis/mylist.csv\") extract_ho(cohort = pat,            codelist = \"mylist\",            indexdt = \"fup_start\",            db = \"mydb\",            tab = \"observation\",            return.output = FALSE,            out.save.disk = TRUE) readRDS(\"data/extraction/var_ho.rds\") #>   patid ho #> 1     1  1 #> 3     3  0 #> 4     4  0 #> 6     6  1"},{"path":"https://alexpate30.github.io/rAURUM/articles/rAURUM.html","id":"extracting-longitudinal-datatime-varying-covariates","dir":"Articles","previous_headings":"Worked example for data extraction > Step 3: Querying the SQLite database to extract variables","what":"Extracting longitudinal data/time varying covariates","title":"rAURUM: An R package to simplify the extraction and processing of CPRD Aurum data, and creating analysis-ready dataset","text":"functions section 3.3.1 3.3.2 option extract data given time point post index date (specified t argument). allows uesrs extract data fixed intervals, can utilised longitudinal analyses time-varying covariates required. saving extracted variables directly disk drive (.save.disk = TRUE), time data extracted , t, added file name default.","code":""},{"path":"https://alexpate30.github.io/rAURUM/articles/rAURUM.html","id":"discussion","dir":"Articles","previous_headings":"","what":"Discussion","title":"rAURUM: An R package to simplify the extraction and processing of CPRD Aurum data, and creating analysis-ready dataset","text":"rAURUM R package allows users process CPRD Aurum data consistent computationally efficiency manner. avoids messy loops, reducing chance coding errors, enables querying large databases handled R workspace. Functions also provided extract common variable types (history specified condition, time event occurs, recent test result), common variables require extract processing (body mass index, cholesterol-high density lipoprotein ratio, smoking status, diabetes category). component rAURUM extracts raw eletronic health record stores SQLite database written flexibility mind. user can define functions reading raw data, allowing functions applied electronic health records, future versions CPRD Aurum different data structures. main goal package reduce duplication efforts among using CPRD data research, allowing time focused aspects research projects.","code":""},{"path":[]},{"path":"https://alexpate30.github.io/rAURUM/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Alexander Pate. Author, maintainer, copyright holder.","code":""},{"path":"https://alexpate30.github.io/rAURUM/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Pate (2024). rAURUM: Extract Manage CPRD Aurum Data Create Analysis-Ready Datasets. R package version 0.0.0.9000, https://alexpate30.github.io/rAURUM/.","code":"@Manual{,   title = {rAURUM: Extract and Manage CPRD Aurum Data and Create Analysis-Ready Datasets},   author = {Alexander Pate},   year = {2024},   note = {R package version 0.0.0.9000},   url = {https://alexpate30.github.io/rAURUM/}, }"},{"path":"https://alexpate30.github.io/rAURUM/index.html","id":"raurum","dir":"","previous_headings":"","what":"Extract and Manage CPRD Aurum Data and Create Analysis-Ready Datasets","title":"Extract and Manage CPRD Aurum Data and Create Analysis-Ready Datasets","text":"goal rAURUM simplify process extracting processing CPRD Aurum data ‘analysis-ready’ dataset can used statistical analyses. process somewhat difficult R, raw data large, provided large number .txt files, read R workspace. rAURUM utilises RSQLite create SQLite databases stored hard disk. queried extract required information cohort interest. processes follow closely rEHR package, designed extractin CPRD GOLD data, longer available CRAN. detailed guide use rAURUM please see user-guide vignette.","code":""},{"path":"https://alexpate30.github.io/rAURUM/index.html","id":"installation","dir":"","previous_headings":"","what":"Installation","title":"Extract and Manage CPRD Aurum Data and Create Analysis-Ready Datasets","text":"can install development version rAURUM GitHub : package yet available CRAN.","code":"# install.packages(\"devtools\") devtools::install_github(\"alexpate30/rAURUM\")"},{"path":"https://alexpate30.github.io/rAURUM/index.html","id":"example","dir":"","previous_headings":"","what":"Example","title":"Extract and Manage CPRD Aurum Data and Create Analysis-Ready Datasets","text":"basic example shows create dataset containing age. data provided package utilised example simulated. Load rAURUM: Create cohort based patient files: Connect SQLite database (example, create temporary file): Read medical data (observation files) add SQLite database. Query database specific codes store R object using db_query function: Add index date patient file, extract variables relative : Extract ‘history ’ type variable, equal 1 individual record specified medcodeid prior index date, equal 0 otherwise. Merge patient file ‘history ’ variable create analysis-ready dataset: Currently functionality exists rAURUM extract medical data observation file (including specific functions extracting test data) medication data drugissue file. Low level functions exist allow user query RSQLite database write functions define variables interest. mid-level functions allow users extract variables certain types (‘history ’, ‘time event’, ‘recent test result’). high level functions allow users extract specific variables, body mass index, systolic blood pressure, smoking status, diabetes status, etc. functions decisions made define variables. sure check code make sure matches definition. example, extract_diabetes return categorical variable three categories, Absent, type1 type2. individual record type 1 type 2 diabetes (according users code lists), extract_diabetes assign individual group type1.","code":"library(rAURUM) #> Loading required package: data.table pat <- extract_cohort(filepath = system.file(\"aurum_data\", package = \"rAURUM\")) str(pat) #> 'data.frame':    12 obs. of  12 variables: #>  $ patid         : chr  \"1\" \"2\" \"3\" \"4\" ... #>  $ pracid        : int  49 79 98 53 62 54 49 79 98 53 ... #>  $ usualgpstaffid: chr  \"6\" \"11\" \"43\" \"72\" ... #>  $ gender        : int  2 1 1 2 2 1 2 1 1 2 ... #>  $ yob           : int  1984 1932 1930 1915 1916 1914 1984 1932 1930 1915 ... #>  $ mob           : int  NA NA NA NA NA NA NA NA NA NA ... #>  $ emis_ddate    : Date, format: \"1976-11-21\" \"1979-02-14\" ... #>  $ regstartdate  : Date, format: \"1940-07-24\" \"1929-02-23\" ... #>  $ patienttypeid : int  58 21 81 10 45 85 58 21 81 10 ... #>  $ regenddate    : Date, format: \"1996-08-25\" \"1945-03-19\" ... #>  $ acceptable    : int  1 0 1 0 0 1 1 0 1 0 ... #>  $ cprd_ddate    : Date, format: \"1935-03-17\" \"1932-02-05\" ... aurum_extract <- connect_database(tempfile(\"temp.sqlite\")) cprd_extract(db = aurum_extract,               filepath = system.file(\"aurum_data\", package = \"rAURUM\"),               filetype = \"observation\") #> [1] \"Adding C:/Program Files/R/R-4.4.0/library/rAURUM/aurum_data/aurum_allpatid_set1_extract_observation_001.txt 2024-06-12 16:31:32.306484\" #> [1] \"Adding C:/Program Files/R/R-4.4.0/library/rAURUM/aurum_data/aurum_allpatid_set1_extract_observation_002.txt 2024-06-12 16:31:33.039292\" #> [1] \"Adding C:/Program Files/R/R-4.4.0/library/rAURUM/aurum_data/aurum_allpatid_set1_extract_observation_003.txt 2024-06-12 16:31:34.068722\" ### Create codelist codelist <- \"187341000000114\"  ### Query for observations with this code db_query(db.open = aurum_extract,          tab =\"observation\",          codelist.vector = codelist) #>     patid consid pracid  obsid obsdate enterdate staffid parentobsid #>    <char> <char>  <int> <char>   <num>     <num>  <char>      <char> #> 1:      1     42      1     81   -5373      4302      85          35 #> 2:      2     56      1     77   -5769    -13828      24           4 #> 3:      6     40      1     41  -14727     -6929      98          80 #>          medcodeid value numunitid obstypeid numrangelow numrangehigh probobsid #>             <char> <num>     <int>     <int>       <num>        <num>    <char> #> 1: 187341000000114    84        79        67          24           22         5 #> 2: 187341000000114    46        92        81          56           30        18 #> 3: 187341000000114    28        20         5          41           97        92 pat$fup_start <- as.Date(\"01/01/2020\", format = \"%d/%m/%Y\") ho <- extract_ho(pat,                   codelist.vector = codelist,                   indexdt = \"fup_start\",                   db.open = aurum_extract,                   tab = \"observation\",                  return.output = TRUE) str(ho) #> 'data.frame':    12 obs. of  2 variables: #>  $ patid: chr  \"1\" \"2\" \"3\" \"4\" ... #>  $ ho   : int  1 1 0 0 0 1 0 0 0 0 ... ### Recursive merge analysis.ready.pat <- merge(pat[,c(\"patid\", \"fup_start\", \"gender\")], ho, by.x = \"patid\", by.y = \"patid\", all.x = TRUE)  analysis.ready.pat #>    patid  fup_start gender ho #> 1      1 2020-01-01      2  1 #> 2     10 2020-01-01      2  0 #> 3     11 2020-01-01      2  0 #> 4     12 2020-01-01      1  0 #> 5      2 2020-01-01      1  1 #> 6      3 2020-01-01      1  0 #> 7      4 2020-01-01      2  0 #> 8      5 2020-01-01      2  0 #> 9      6 2020-01-01      1  1 #> 10     7 2020-01-01      2  0 #> 11     8 2020-01-01      1  0 #> 12     9 2020-01-01      1  0"},{"path":"https://alexpate30.github.io/rAURUM/index.html","id":"package-maintainence","dir":"","previous_headings":"","what":"Package maintainence","title":"Extract and Manage CPRD Aurum Data and Create Analysis-Ready Datasets","text":"parts package create SQLite database somewhat dependent structure raw CPRD Aurum data. example, functions read raw text files (e.g. extract_txt_obs) hard coded format variables specific names certain way (e.g. convert obsdate character variable date variable). time, structure CPRD Aurum data may change, impact utility package. endeavor keep rAURUM updated new releases CPRD Aurum. However, possible, tried protect giving user flexible options well defaults. example, add_to_database defaults using extract_txt_obs read raw text data filetype = \"observation\" specified. However, also option extract.txt.func, allows users specify function read text data, override use extract_txt_obs. Despite , may breaking points haven’t thought , case please let us know.","code":""},{"path":"https://alexpate30.github.io/rAURUM/index.html","id":"getting-help","dir":"","previous_headings":"","what":"Getting help","title":"Extract and Manage CPRD Aurum Data and Create Analysis-Ready Datasets","text":"encounter bug, please file issue minimal reproducible example GitHub.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/add_to_database.html","id":null,"dir":"Reference","previous_headings":"","what":"Adds a single .txt file to an SQLite database on the hard disk. — add_to_database","title":"Adds a single .txt file to an SQLite database on the hard disk. — add_to_database","text":"Add raw data one CPRD flatfiles SQLite database.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/add_to_database.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Adds a single .txt file to an SQLite database on the hard disk. — add_to_database","text":"","code":"add_to_database(   filepath,   filetype = c(\"observation\", \"drugissue\", \"referral\", \"problem\", \"consultation\",     \"hes_primary\", \"death\"),   nrows = -1,   select = NULL,   subset.patids = NULL,   use.set = FALSE,   db,   extract.txt.func = NULL,   tablename = NULL,   ... )"},{"path":"https://alexpate30.github.io/rAURUM/reference/add_to_database.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Adds a single .txt file to an SQLite database on the hard disk. — add_to_database","text":"filepath Path .txt file system. filetype Type CPRD Aurum file (observation, drugissue, referral, problem, consultation, hes_primary, death) nrows Number rows read .txt file. select Character vector column names select adding SQLite database. subset.patids Patient id's subset .txt file adding SQLite database. use.set Reduce subset.patids just corresponding set value .txt file read . Can greatly improve computational efficiency subset.patids large. See vignette XXXX details. db open SQLite database connection created using RSQLite::dbConnect. extract.txt.func User-defined function read .txt file R. tablename Name table SQLite database data added . ... Extract arguments passed read.table (extract.txt.func) reading .txt files.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/add_to_database.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Adds a single .txt file to an SQLite database on the hard disk. — add_to_database","text":"Adds .txt file SQLite database hard disk.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/add_to_database.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Adds a single .txt file to an SQLite database on the hard disk. — add_to_database","text":"add file table named filetype SQLite database, unless tablename specified. use.set = FALSE, subset.patids vector patid's .txt files subsetted adding SQLite database. use.set = TRUE, subset.patids dataframe two columns, patid set, set corresponds number file name following word 'set'. functionality provided increase computational efficiency subsetting cohort patients large (millions). can computationally expensive process flatfile read , must cross matched large vector . CPRD flatfiles split groups can identified naming convention. Patients set 1, data DrugIssue, Observation, etc, \"set\" suffix flatfile name. can utilise speed process subsetting data flatfiles patids subset.patid. Instead subset patids subset.patids, corresponding value \"set\", matches suffix \"set\" CPRD flatfile filename. example, patients Patient file suffix \"set1\", medical data Observation file suffix \"set1\". subsetting Observation file subset.patids (cohort), need patients also patient file suffix \"set1\". cohort patients want subset data small, computational gains argument minor can ignored. function reading .txt file chosen set functions provided rAURUM, based  fletype (filetype). extract.txt.func need specified unless wanting manually define function . may beneficial wanting change variable formats, variables .txt files change future releases CPRD AURUM.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/add_to_database.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Adds a single .txt file to an SQLite database on the hard disk. — add_to_database","text":"","code":"## Create connection to a temporary database aurum_extract <- connect_database(tempfile(\"temp.sqlite\"))  ## Add observation data add_to_database(filepath = system.file(\"aurum_data\", \"aurum_allpatid_set1_extract_observation_001.txt\", package = \"rAURUM\"), filetype = \"observation\", db = aurum_extract, overwrite = TRUE)  ## Query database RSQLite::dbGetQuery(aurum_extract, 'SELECT * FROM observation', n = 3) #>   patid consid pracid obsid obsdate enterdate staffid parentobsid #> 1     1     33      1   100  -15931      -994      79          95 #> 2     1     66      1    46  -13782    -15232      34          17 #> 3     1     41      1    53  -20002      8845      35          79 #>           medcodeid value numunitid obstypeid numrangelow numrangehigh #> 1   498521000006119    48        16        20          28           86 #> 2         401539014    22         1         2          27            8 #> 3 13483031000006114    17        78        13          87           41 #>   probobsid #> 1        54 #> 2        35 #> 3        74"},{"path":"https://alexpate30.github.io/rAURUM/reference/combine_query.html","id":null,"dir":"Reference","previous_headings":"","what":"Combine a database query with a cohort. — combine_query","title":"Combine a database query with a cohort. — combine_query","text":"Combine database query cohort, retaining observations time.prev days prior indexdt, time.post days indexdt, test data values lower.bound upper.bound. recent numobs observations returned. cohort must contain variables patid indexdt. type query must specified appropriate data manipulation. Input type = med interested medical diagnoses observation file, type = test interseted test data observation file.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/combine_query.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Combine a database query with a cohort. — combine_query","text":"","code":"combine_query(   cohort,   db.query,   query.type = c(\"med\", \"test\", \"drugissue\", \"hes_primary\", \"death\"),   time.prev = Inf,   time.post = Inf,   lower.bound = -Inf,   upper.bound = Inf,   numobs = 1,   value.na.rm = TRUE,   earliest.values = FALSE,   reduce.output = TRUE )"},{"path":"https://alexpate30.github.io/rAURUM/reference/combine_query.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Combine a database query with a cohort. — combine_query","text":"cohort Cohort combine database query. db.query Output database query (ideally obtained db_query). query.type Type query time.prev Number days prior index date look codes. time.post Number days index date look codes. lower.bound Lower bound returned values query.type = \"test\". upper.bound Upper bound returned values query.type = \"test\". numobs Number observations returned. value.na.rm TRUE remove data NA value column queried data remove values outside lower.bound upper.bound query.type = \"test\". earliest.values TRUE return earliest values opposed recent. reduce.output TRUE reduce output just patid, obsdate, medical/product code, test value.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/combine_query.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Combine a database query with a cohort. — combine_query","text":"data.table observations meet specified criteria.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/combine_query.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Combine a database query with a cohort. — combine_query","text":"value.na.rm = FALSE may use extracting variables like smoking status, want test data number cigarettes per day, want remove observations NA value column, medcodeid may indicate smoking status.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/combine_query.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Combine a database query with a cohort. — combine_query","text":"","code":"## Create connection to a temporary database aurum_extract <- connect_database(tempfile(\"temp.sqlite\"))  ## Add observation data from all observation files in specified directory cprd_extract(db = aurum_extract, filepath = system.file(\"aurum_data\", package = \"rAURUM\"), filetype = \"observation\") #>    |                                                                               |                                                                      |   0%[1] \"Adding /home/runner/work/_temp/Library/rAURUM/aurum_data/aurum_allpatid_set1_extract_observation_001.txt 2024-08-02 16:56:20.919272\" #>    |                                                                               |=======================                                               |  33%[1] \"Adding /home/runner/work/_temp/Library/rAURUM/aurum_data/aurum_allpatid_set1_extract_observation_002.txt 2024-08-02 16:56:20.957043\" #>    |                                                                               |===============================================                       |  67%[1] \"Adding /home/runner/work/_temp/Library/rAURUM/aurum_data/aurum_allpatid_set1_extract_observation_003.txt 2024-08-02 16:56:20.968448\" #>    |                                                                               |======================================================================| 100%  ## Query database for a specific medcode db.query <- db_query(db.open = aurum_extract, tab =\"observation\", codelist.vector = \"187341000000114\")  ## Define cohort pat<-extract_cohort(filepath = system.file(\"aurum_data\", package = \"rAURUM\"))  ### Add an index date to pat pat$indexdt <- as.Date(\"01/01/2020\", format = \"%d/%m/%Y\")  ## Combine query with cohort retaining most recent three records combine_query(cohort = pat, db.query = db.query, query.type = \"med\", numobs = 3) #>     patid       medcodeid obsdate #>    <char>          <char>   <num> #> 1:      1 187341000000114   -5373 #> 2:      2 187341000000114   -5769 #> 3:      6 187341000000114  -14727"},{"path":"https://alexpate30.github.io/rAURUM/reference/combine_query_boolean.html","id":null,"dir":"Reference","previous_headings":"","what":"Combine a database query with a cohort returning a 0/1 vector depending on whether each individual has a recorded code of interest. — combine_query_boolean","title":"Combine a database query with a cohort returning a 0/1 vector depending on whether each individual has a recorded code of interest. — combine_query_boolean","text":"Combine database query cohort returning 0/1 vector depending whether individual recorded code interest. cohort must contain variables patid indexdt. database query merged cohort variable patid. individual least numobs observations time.prev days prior indexdt, time.post days indexdt, 1 returned, 0 otherwise. type query must specified appropriate data manipulation.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/combine_query_boolean.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Combine a database query with a cohort returning a 0/1 vector depending on whether each individual has a recorded code of interest. — combine_query_boolean","text":"","code":"combine_query_boolean(   cohort,   db.query,   query.type = c(\"observation\", \"drugissue\", \"hes_primary\"),   time.prev = Inf,   time.post = 0,   numobs = 1 )"},{"path":"https://alexpate30.github.io/rAURUM/reference/combine_query_boolean.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Combine a database query with a cohort returning a 0/1 vector depending on whether each individual has a recorded code of interest. — combine_query_boolean","text":"cohort Cohort combine database query. db.query Output database query (ideally obtained db_query). query.type Type query time.prev Number days prior index date look codes. time.post Number days index date look codes. numobs Number observations required observed specified time window return 1.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/combine_query_boolean.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Combine a database query with a cohort returning a 0/1 vector depending on whether each individual has a recorded code of interest. — combine_query_boolean","text":"0/1 vector.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/combine_query_boolean.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Combine a database query with a cohort returning a 0/1 vector depending on whether each individual has a recorded code of interest. — combine_query_boolean","text":"","code":"## Create connection to a temporary database aurum_extract <- connect_database(tempfile(\"temp.sqlite\"))  ## Add observation data from all observation files in specified directory cprd_extract(db = aurum_extract, filepath = system.file(\"aurum_data\", package = \"rAURUM\"), filetype = \"observation\") #>    |                                                                               |                                                                      |   0%[1] \"Adding /home/runner/work/_temp/Library/rAURUM/aurum_data/aurum_allpatid_set1_extract_observation_001.txt 2024-08-02 16:56:21.24552\" #>    |                                                                               |=======================                                               |  33%[1] \"Adding /home/runner/work/_temp/Library/rAURUM/aurum_data/aurum_allpatid_set1_extract_observation_002.txt 2024-08-02 16:56:21.257875\" #>    |                                                                               |===============================================                       |  67%[1] \"Adding /home/runner/work/_temp/Library/rAURUM/aurum_data/aurum_allpatid_set1_extract_observation_003.txt 2024-08-02 16:56:21.268709\" #>    |                                                                               |======================================================================| 100%  ## Query database for a specific medcode db.query <- db_query(db.open = aurum_extract, tab =\"observation\", codelist.vector = \"187341000000114\")  ## Define cohort pat<-extract_cohort(filepath = system.file(\"aurum_data\", package = \"rAURUM\"))  ### Add an index date to pat pat$indexdt <- as.Date(\"01/01/2020\", format = \"%d/%m/%Y\")  ## Combine query with cohort creating a 'history of' boolean variable combine_query_boolean(cohort = pat, db.query = db.query, query.type = \"observation\") #>  [1] 1 1 0 0 0 1 0 0 0 0 0 0"},{"path":"https://alexpate30.github.io/rAURUM/reference/connect_database.html","id":null,"dir":"Reference","previous_headings":"","what":"Open connection to SQLite database — connect_database","title":"Open connection to SQLite database — connect_database","text":"Open connection SQLite database","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/connect_database.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Open connection to SQLite database — connect_database","text":"","code":"connect_database(dbname)"},{"path":"https://alexpate30.github.io/rAURUM/reference/connect_database.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Open connection to SQLite database — connect_database","text":"dbname Name SQLite database hard disk (including full file path relative working directory)","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/connect_database.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Open connection to SQLite database — connect_database","text":"","code":"## Connect to a database aurum_extract <- connect_database(tempfile(\"temp.sqlite\"))  ## Check connection is open inherits(aurum_extract, \"DBIConnection\") #> [1] TRUE"},{"path":"https://alexpate30.github.io/rAURUM/reference/cprd_extract.html","id":null,"dir":"Reference","previous_headings":"","what":"Adds all the .txt files in a directory, with certain file names, to an SQLite database on the hard disk. — cprd_extract","title":"Adds all the .txt files in a directory, with certain file names, to an SQLite database on the hard disk. — cprd_extract","text":"Add raw data one CPRD flatfiles SQLite database.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/cprd_extract.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Adds all the .txt files in a directory, with certain file names, to an SQLite database on the hard disk. — cprd_extract","text":"","code":"cprd_extract(   db,   filepath,   filetype = c(\"observation\", \"drugissue\", \"referral\", \"problem\", \"consultation\",     \"hes_primary\", \"death\"),   nrows = -1,   select = NULL,   subset.patids = NULL,   use.set = FALSE,   extract.txt.func = NULL,   str.match = NULL,   tablename = NULL )"},{"path":"https://alexpate30.github.io/rAURUM/reference/cprd_extract.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Adds all the .txt files in a directory, with certain file names, to an SQLite database on the hard disk. — cprd_extract","text":"db open SQLite database connection created using RSQLite::dbConnect. filepath Path directory containing .txt files. filetype Type CPRD Aurum file (observation, drugissue, referral, problem, consultation, hes_primary, death) nrows Number rows read .txt file. select Vector column names select adding SQLite database. subset.patids Patient id's subset .txt file adding SQLite database. use.set Reduce subset.patids just corresponding set value .txt file read . Can greatly improve computational efficiency subset.patids large. See vignette XXXX details. extract.txt.func User-defined function read .txt file R. str.match Character vector match searching file names add database. tablename Name table SQLite database data added .","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/cprd_extract.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Adds all the .txt files in a directory, with certain file names, to an SQLite database on the hard disk. — cprd_extract","text":"Adds .txt file SQLite database hard disk.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/cprd_extract.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Adds all the .txt files in a directory, with certain file names, to an SQLite database on the hard disk. — cprd_extract","text":"default, add files contain filetype file name table named filetype SQLite database. str.match specified, add files contain str.match file name table named str.match SQLite database. case, filetype still used choose function reads formats raw data, although can overwritten extract.txt.func. argument tablename specified, data added table called tablename SQLite database. Currently, rAURUM deals filetype = c(\"observation\", \"drugissue\", \"referral\", \"problem\", \"consultation\", \"hes_primary\", \"death\") default. However, using str.match extract.txt.func, user can manually search files string file name, read format using user-defined function. means user restricted adding pre-defined file types SQLite database. use.set = FALSE, subset.patids vector patid's .txt files subsetted adding SQLite database. use.set = TRUE, subset.patids dataframe two columns, patid set, set corresponds number file name following word 'set'. functionality provided increase computational efficiency subsetting cohort patients large (millions). can computationally expensive process flatfile read , must cross matched large vector . CPRD flatfiles split groups can identified naming convention. Patients set 1, data DrugIssue, Observation, etc, \"set\" suffix flatfile name. can utilise speed process subsetting data flatfiles patids subset.patid. Instead subset patids subset.patids, corresponding value \"set\", matches suffix \"set\" CPRD flatfile file name. example, patients Patient file suffix \"set1\", medical data Observation file suffix \"set1\". subsetting Observation file subset.patids (cohort), need patients also patient file suffix \"set1\". cohort patients want subset data small, computational gains argument minor can ignored. function reading .txt file chosen set functions provided rAURUM, based  filetype (filetype). extract.txt.func need specified unless wanting manually define function . may beneficial wanting change variable formats, variables .txt files change future releases CPRD AURUM rAURUM updated.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/cprd_extract.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Adds all the .txt files in a directory, with certain file names, to an SQLite database on the hard disk. — cprd_extract","text":"","code":"## Create connection to a temporary database aurum_extract <- connect_database(tempfile(\"temp.sqlite\"))  ## Add observation data from all observation files in specified directory cprd_extract(db = aurum_extract, filepath = system.file(\"aurum_data\", package = \"rAURUM\"), filetype = \"observation\") #>    |                                                                               |                                                                      |   0%[1] \"Adding /home/runner/work/_temp/Library/rAURUM/aurum_data/aurum_allpatid_set1_extract_observation_001.txt 2024-08-02 16:56:21.63176\" #>    |                                                                               |=======================                                               |  33%[1] \"Adding /home/runner/work/_temp/Library/rAURUM/aurum_data/aurum_allpatid_set1_extract_observation_002.txt 2024-08-02 16:56:21.64406\" #>    |                                                                               |===============================================                       |  67%[1] \"Adding /home/runner/work/_temp/Library/rAURUM/aurum_data/aurum_allpatid_set1_extract_observation_003.txt 2024-08-02 16:56:21.654756\" #>    |                                                                               |======================================================================| 100%  ## Query database RSQLite::dbGetQuery(aurum_extract, 'SELECT * FROM observation', n = 3) #>   patid consid pracid obsid obsdate enterdate staffid parentobsid #> 1     1     33      1   100  -15931      -994      79          95 #> 2     1     66      1    46  -13782    -15232      34          17 #> 3     1     41      1    53  -20002      8845      35          79 #>           medcodeid value numunitid obstypeid numrangelow numrangehigh #> 1   498521000006119    48        16        20          28           86 #> 2         401539014    22         1         2          27            8 #> 3 13483031000006114    17        78        13          87           41 #>   probobsid #> 1        54 #> 2        35 #> 3        74"},{"path":"https://alexpate30.github.io/rAURUM/reference/create_directory_system.html","id":null,"dir":"Reference","previous_headings":"","what":"Create the appropriate root directory system to be able to run functions with specifying hard filepaths — create_directory_system","title":"Create the appropriate root directory system to be able to run functions with specifying hard filepaths — create_directory_system","text":"Create appropriate root directory system able run functions specifying hard filepaths","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/create_directory_system.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Create the appropriate root directory system to be able to run functions with specifying hard filepaths — create_directory_system","text":"","code":"create_directory_system(rootdir = NULL)"},{"path":"https://alexpate30.github.io/rAURUM/reference/create_directory_system.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Create the appropriate root directory system to be able to run functions with specifying hard filepaths — create_directory_system","text":"rootdir Directory within create directory system","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/create_directory_system.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Create the appropriate root directory system to be able to run functions with specifying hard filepaths — create_directory_system","text":"","code":"if (FALSE) { # \\dontrun{ ## Print current working directory getwd()  ## Create directory system compatible with rAURUM's automatic saving of ## output create_directory_system()  ## Connect aurum_extract <- connect_database(\"data/sql/temp.sqlite\")  ## Create SQLite database using cprd_extract cprd_extract(aurum_extract, filepath = system.file(\"aurum_data\", package = \"rAURUM\"), filetype = \"observation\", use.set = FALSE)  ## Define cohort and add index date pat<-extract_cohort(system.file(\"aurum_data\", package = \"rAURUM\")) pat$indexdt <- as.Date(\"01/01/1955\", format = \"%d/%m/%Y\")  ## Extract a history of type variable and save to disc automatically, ## by just specifying name of database extract_ho(pat, codelist.vector = \"187341000000114\", indexdt = \"fup_start\", db = \"temp\", tab = \"observation\", out.save.disk = TRUE)  ## Read file from disk into R workspace readRDS(\"data/extraction/var_ho.rds\") } # }"},{"path":"https://alexpate30.github.io/rAURUM/reference/db_query.html","id":null,"dir":"Reference","previous_headings":"","what":"Query an RSQLite database. — db_query","title":"Query an RSQLite database. — db_query","text":"Query RSQLite database stored hard disk observations specific codes.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/db_query.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Query an RSQLite database. — db_query","text":"","code":"db_query(   codelist,   db.open = NULL,   db = NULL,   db.filepath = NULL,   tab = c(\"observation\", \"drugissue\", \"hes_primary\", \"death\"),   codelist.vector = NULL )"},{"path":"https://alexpate30.github.io/rAURUM/reference/db_query.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Query an RSQLite database. — db_query","text":"codelist Name codelist query database . db.open open SQLite database connection created using RSQLite::dbConnect, queried. db Name SQLITE database hard disk, queried. db.filepath Full filepath SQLITE database hard disk, queried. tab Name table SQLite database queried. codelist.vector Vector codes query database . takes precedent codelist specified.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/db_query.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Query an RSQLite database. — db_query","text":"data.table observations contained specified codelist.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/db_query.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Query an RSQLite database. — db_query","text":"Specifying db requires specific underlying directory structure. SQLite database must stored \"data/sql/\" relative working directory. SQLite database accessed db, connection opened closed query complete. true database accessed db.filepath. connection SQLite database can also opened manually using RSQLite::dbConnect, using object input parameter db.open. wards, connection must closed manually using RSQLite::dbDisconnect. db.open specified, take precedence db db.filepath. Specifying codelist requires specific underlying directory structure. codelist hard disk must stored \"codelists/analysis/\" relative working directory, must .csv file, contain column \"medcodeid\", \"prodcodeid\" \"ICD10\" depending chosen tab. codelist can also read manually, supplied character vector codelist.vector. codelist.vector defined, take precedence codelist.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/db_query.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Query an RSQLite database. — db_query","text":"","code":"## Create connection to a temporary database aurum_extract <- connect_database(tempfile(\"temp.sqlite\"))  ## Add observation data from all observation files in specified directory cprd_extract(db = aurum_extract, filepath = system.file(\"aurum_data\", package = \"rAURUM\"), filetype = \"observation\") #>    |                                                                               |                                                                      |   0%[1] \"Adding /home/runner/work/_temp/Library/rAURUM/aurum_data/aurum_allpatid_set1_extract_observation_001.txt 2024-08-02 16:56:22.003025\" #>    |                                                                               |=======================                                               |  33%[1] \"Adding /home/runner/work/_temp/Library/rAURUM/aurum_data/aurum_allpatid_set1_extract_observation_002.txt 2024-08-02 16:56:22.015751\" #>    |                                                                               |===============================================                       |  67%[1] \"Adding /home/runner/work/_temp/Library/rAURUM/aurum_data/aurum_allpatid_set1_extract_observation_003.txt 2024-08-02 16:56:22.026946\" #>    |                                                                               |======================================================================| 100%  ## Query database for a specific medcode db_query(db.open = aurum_extract, tab =\"observation\", codelist.vector = \"187341000000114\") #>     patid consid pracid  obsid obsdate enterdate staffid parentobsid #>    <char> <char>  <int> <char>   <num>     <num>  <char>      <char> #> 1:      1     42      1     81   -5373      4302      85          35 #> 2:      2     56      1     77   -5769    -13828      24           4 #> 3:      6     40      1     41  -14727     -6929      98          80 #>          medcodeid value numunitid obstypeid numrangelow numrangehigh probobsid #>             <char> <num>     <int>     <int>       <num>        <num>    <char> #> 1: 187341000000114    84        79        67          24           22         5 #> 2: 187341000000114    46        92        81          56           30        18 #> 3: 187341000000114    28        20         5          41           97        92"},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_bmi.html","id":null,"dir":"Reference","previous_headings":"","what":"Extract most recent BMI score relative to an index date. — extract_bmi","title":"Extract most recent BMI score relative to an index date. — extract_bmi","text":"Extract recent BMI score relative index date.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_bmi.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Extract most recent BMI score relative to an index date. — extract_bmi","text":"","code":"extract_bmi(   cohort,   varname = NULL,   codelist.bmi,   codelist.weight,   codelist.height,   codelist.bmi.vector,   codelist.weight.vector,   codelist.height.vector,   indexdt,   t = NULL,   t.varname = TRUE,   time.prev = 365.25 * 5,   time.post = 0,   lower.bound = -Inf,   upper.bound = Inf,   db.open = NULL,   db = NULL,   db.filepath = NULL,   out.save.disk = FALSE,   out.subdir = NULL,   out.filepath = NULL,   return.output = TRUE )"},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_bmi.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Extract most recent BMI score relative to an index date. — extract_bmi","text":"cohort Cohort extract age . varname Optional name variable output dataset. codelist.bmi Name codelist (stored hard disk \"codelists/analysis/\") BMI query database . codelist.weight Name codelist (stored hard disk \"codelists/analysis/\") weight query database . codelist.height Name codelist (stored hard disk \"codelists/analysis/\") height query database . codelist.bmi.vector Vector codes BMI query database . codelist.weight.vector Vector codes weight query database . codelist.height.vector Vector codes height query database . indexdt Name variable defines index date cohort. t Number days index date calculate variable. t.varname Whether add t varname. time.prev Number days prior index date look codes. time.post Number days index date look codes. lower.bound Lower bound returned values. upper.bound Upper bound returned values. db.open open SQLite database connection created using RSQLite::dbConnect, queried. db Name SQLITE database hard disk (stored \"data/sql/\"), queried. db.filepath Full filepath SQLITE database hard disk, queried. .save.disk TRUE attempt save outputted data frame directory \"data/extraction/\". .subdir Sub-directory \"data/extraction/\" save outputted data frame . .filepath Full filepath filename save outputted data frame . return.output TRUE return outputted data frame R workspace.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_bmi.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Extract most recent BMI score relative to an index date. — extract_bmi","text":"data frame variable BMI.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_bmi.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Extract most recent BMI score relative to an index date. — extract_bmi","text":"BMI can either identified directly recorded BMI score, calculated via height weight scores. Full details algorithm extracting BMI given vignette: Details--algorithms--extracting-specific-variables. vignette can viewed running vignette(\"help\", package = \"rAURUM\"). Specifying db requires specific underlying directory structure. SQLite database must stored \"data/sql/\" relative working directory. SQLite database accessed db, connection opened closed query complete. true database accessed db.filepath. connection SQLite database can also opened manually using RSQLite::dbConnect, using object input parameter db.open. wards, connection must closed manually using RSQLite::dbDisconnect. db.open specified, take precedence db db.filepath. .save.disk = TRUE, data frame automatically written .rds file subdirectory \"data/extraction/\" working directory. directory structure must created advance. .subdir can used specify subdirectories within \"data/extraction/\". options use default naming convetion. can overwritten using .filepath manually specify location hard disk save. Alternatively, return data frame R workspace using return.output = TRUE save onto hard disk manually. Specifying non-vector type codelists requires specific underlying directory structure. codelist hard disk must stored \"codelists/analysis/\" relative working directory, must .csv file, contain column \"medcodeid\", \"prodcodeid\" \"ICD10\" depending chosen tab. input variables just name files (excluding suffix .csv). codelists can also read manually, supplied character vector. option take precedence codelists stored hard disk specified.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_bmi.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Extract most recent BMI score relative to an index date. — extract_bmi","text":"","code":"## Connect aurum_extract <- connect_database(tempfile(\"temp.sqlite\"))  ## Create SQLite database using cprd_extract cprd_extract(aurum_extract, filepath = system.file(\"aurum_data\", package = \"rAURUM\"), filetype = \"observation\", use.set = FALSE) #>    |                                                                               |                                                                      |   0%[1] \"Adding /home/runner/work/_temp/Library/rAURUM/aurum_data/aurum_allpatid_set1_extract_observation_001.txt 2024-08-02 16:56:22.206204\" #>    |                                                                               |=======================                                               |  33%[1] \"Adding /home/runner/work/_temp/Library/rAURUM/aurum_data/aurum_allpatid_set1_extract_observation_002.txt 2024-08-02 16:56:22.21915\" #>    |                                                                               |===============================================                       |  67%[1] \"Adding /home/runner/work/_temp/Library/rAURUM/aurum_data/aurum_allpatid_set1_extract_observation_003.txt 2024-08-02 16:56:22.230273\" #>    |                                                                               |======================================================================| 100%  ## Define cohort and add index date pat<-extract_cohort(system.file(\"aurum_data\", package = \"rAURUM\")) pat$indexdt <- as.Date(\"01/01/1955\", format = \"%d/%m/%Y\")  ## Extract most recent BMI prior to index date extract_bmi(cohort = pat, codelist.bmi.vector = \"498521000006119\", codelist.weight.vector = \"401539014\", codelist.height.vector = \"13483031000006114\", indexdt = \"indexdt\", time.prev = Inf, db.open = aurum_extract, return.output = TRUE) #>    patid bmi #> 1      1  48 #> 2     10  NA #> 3     11  NA #> 4     12  NA #> 5      2  NA #> 6      3  NA #> 7      4  NA #> 8      5  18 #> 9      6  NA #> 10     7  NA #> 11     8  NA #> 12     9  NA"},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_cholhdl_ratio.html","id":null,"dir":"Reference","previous_headings":"","what":"Extract most recent total cholesterol/high-density lipoprotein ratio score relative to an index date. — extract_cholhdl_ratio","title":"Extract most recent total cholesterol/high-density lipoprotein ratio score relative to an index date. — extract_cholhdl_ratio","text":"Extract recent total cholesterol/high-density lipoprotein ratio score relative index date.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_cholhdl_ratio.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Extract most recent total cholesterol/high-density lipoprotein ratio score relative to an index date. — extract_cholhdl_ratio","text":"","code":"extract_cholhdl_ratio(   cohort,   varname = NULL,   codelist.ratio,   codelist.chol,   codelist.hdl,   codelist.ratio.vector,   codelist.chol.vector,   codelist.hdl.vector,   indexdt,   t = NULL,   t.varname = TRUE,   time.prev = 365.25 * 5,   time.post = 0,   lower.bound = -Inf,   upper.bound = Inf,   db.open = NULL,   db = NULL,   db.filepath = NULL,   out.save.disk = FALSE,   out.subdir = NULL,   out.filepath = NULL,   return.output = TRUE )"},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_cholhdl_ratio.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Extract most recent total cholesterol/high-density lipoprotein ratio score relative to an index date. — extract_cholhdl_ratio","text":"cohort Cohort extract age . varname Optional name variable output dataset. codelist.ratio Name codelist (stored hard disk \"codelists/analysis/\") ratio query database . codelist.chol Name codelist (stored hard disk \"codelists/analysis/\") total cholesterol query database . codelist.hdl Name codelist (stored hard disk \"codelists/analysis/\") high-density lipoprotein query database . codelist.ratio.vector Vector codes ratio query database . codelist.chol.vector Vector codes total cholesterol query database . codelist.hdl.vector Vector codes high-density lipoprotein query database . indexdt Name variable defines index date cohort. t Number days index date calculate variable. t.varname Whether add t varname. time.prev Number days prior index date look codes. time.post Number days index date look codes. lower.bound Lower bound returned values. upper.bound Upper bound returned values. db.open open SQLite database connection created using RSQLite::dbConnect, queried. db Name SQLITE database hard disk (stored \"data/sql/\"), queried. db.filepath Full filepath SQLITE database hard disk, queried. .save.disk TRUE attempt save outputted data frame directory \"data/extraction/\". .subdir Sub-directory \"data/extraction/\" save outputted data frame . .filepath Full filepath filename save outputted data frame . return.output TRUE return outputted data frame R workspace.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_cholhdl_ratio.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Extract most recent total cholesterol/high-density lipoprotein ratio score relative to an index date. — extract_cholhdl_ratio","text":"data frame variable total cholesterol/high-density lipoprotein ratio.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_cholhdl_ratio.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Extract most recent total cholesterol/high-density lipoprotein ratio score relative to an index date. — extract_cholhdl_ratio","text":"Cholesterol/HDL ratio can either identified directly recorded cholesterol/hdl ratio score, calculated via total cholesterol HDL scores. Full details algorithm extracting cholesterol/hdl ratio given vignette: Details--algorithms--extracting-specific-variables. vignette can viewed running vignette(\"help\", package = \"rAURUM\"). Specifying db requires specific underlying directory structure. SQLite database must stored \"data/sql/\" relative working directory. SQLite database accessed db, connection opened closed query complete. true database accessed db.filepath. connection SQLite database can also opened manually using RSQLite::dbConnect, using object input parameter db.open. wards, connection must closed manually using RSQLite::dbDisconnect. db.open specified, take precedence db db.filepath. .save.disk = TRUE, data frame automatically written .rds file subdirectory \"data/extraction/\" working directory. directory structure must created advance. .subdir can used specify subdirectories within \"data/extraction/\". options use default naming convetion. can overwritten using .filepath manually specify location hard disk save. Alternatively, return data frame R workspace using return.output = TRUE save onto hard disk manually. Specifying non-vector type codelists requires specific underlying directory structure. codelist hard disk must stored \"codelists/analysis/\" relative working directory, must .csv file, contain column \"medcodeid\", \"prodcodeid\" \"ICD10\" depending chosen tab. input variables just name files (excluding suffix .csv). codelists can also read manually, supplied character vector. option take precedence codelists stored hard disk specified.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_cholhdl_ratio.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Extract most recent total cholesterol/high-density lipoprotein ratio score relative to an index date. — extract_cholhdl_ratio","text":"","code":"## Connect aurum_extract <- connect_database(tempfile(\"temp.sqlite\"))  ## Create SQLite database using cprd_extract cprd_extract(aurum_extract, filepath = system.file(\"aurum_data\", package = \"rAURUM\"), filetype = \"observation\", use.set = FALSE) #>    |                                                                               |                                                                      |   0%[1] \"Adding /home/runner/work/_temp/Library/rAURUM/aurum_data/aurum_allpatid_set1_extract_observation_001.txt 2024-08-02 16:56:22.737876\" #>    |                                                                               |=======================                                               |  33%[1] \"Adding /home/runner/work/_temp/Library/rAURUM/aurum_data/aurum_allpatid_set1_extract_observation_002.txt 2024-08-02 16:56:22.751014\" #>    |                                                                               |===============================================                       |  67%[1] \"Adding /home/runner/work/_temp/Library/rAURUM/aurum_data/aurum_allpatid_set1_extract_observation_003.txt 2024-08-02 16:56:22.762421\" #>    |                                                                               |======================================================================| 100%  ## Define cohort and add index date pat<-extract_cohort(system.file(\"aurum_data\", package = \"rAURUM\")) pat$indexdt <- as.Date(\"01/01/1955\", format = \"%d/%m/%Y\")  ## Extract most recent cholhdl_ratio prior to index date extract_cholhdl_ratio(cohort = pat, codelist.ratio.vector = \"498521000006119\", codelist.chol.vector = \"401539014\", codelist.hdl.vector = \"13483031000006114\", indexdt = \"indexdt\", time.prev = Inf, db.open = aurum_extract, return.output = TRUE) #>    patid cholhdl_ratio #> 1      1            48 #> 2     10            NA #> 3     11            NA #> 4     12            NA #> 5      2            NA #> 6      3            NA #> 7      4            NA #> 8      5            18 #> 9      6            NA #> 10     7            NA #> 11     8            NA #> 12     9            NA"},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_cohort.html","id":null,"dir":"Reference","previous_headings":"","what":"Create cohort from patient files — extract_cohort","title":"Create cohort from patient files — extract_cohort","text":"Create cohort patient files","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_cohort.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Create cohort from patient files — extract_cohort","text":"","code":"extract_cohort(filepath, patids = NULL, select = NULL, set = FALSE)"},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_cohort.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Create cohort from patient files — extract_cohort","text":"filepath Path directory containing .txt files. patids Patids patients retain cohort. Character vector. Numeric values used. select Character vector column names select. set TRUE create variable called set contain number comes word 'set' file name.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_cohort.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Create cohort from patient files — extract_cohort","text":"Data frame patient information","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_cohort.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Create cohort from patient files — extract_cohort","text":"","code":"## Extract cohort data pat<-extract_cohort(filepath = system.file(\"aurum_data\", package = \"rAURUM\")) pat #>    patid pracid usualgpstaffid gender  yob mob emis_ddate regstartdate #> 1      1     49              6      2 1984  NA 1976-11-21   1940-07-24 #> 2      2     79             11      1 1932  NA 1979-02-14   1929-02-23 #> 3      3     98             43      1 1930  NA 1972-06-01   1913-07-02 #> 4      4     53             72      2 1915  NA 1989-04-24   1969-07-11 #> 5      5     62             16      2 1916  NA 1951-09-23   1919-11-07 #> 6      6     54             11      1 1914  NA 1926-09-09   1970-08-28 #> 7      7     49              6      2 1984  NA 1976-11-21   1940-07-24 #> 8      8     79             11      1 1932  NA 1979-02-14   1929-02-23 #> 9      9     98             43      1 1930  NA 1972-06-01   1913-07-02 #> 10    10     53             72      2 1915  NA 1989-04-24   1969-07-11 #> 11    11     62             16      2 1916  NA 1951-09-23   1919-11-07 #> 12    12     54             11      1 1914  NA 1926-09-09   1970-08-28 #>    patienttypeid regenddate acceptable cprd_ddate #> 1             58 1996-08-25          1 1935-03-17 #> 2             21 1945-03-19          0 1932-02-05 #> 3             81 1997-04-24          1 1912-04-27 #> 4             10 1951-09-05          0 1921-02-13 #> 5             45 1998-11-25          0 1903-08-26 #> 6             85 1983-03-14          1 1963-08-27 #> 7             58 1996-08-25          1 1935-03-17 #> 8             21 1945-03-19          0 1932-02-05 #> 9             81 1997-04-24          1 1912-04-27 #> 10            10 1951-09-05          0 1921-02-13 #> 11            45 1998-11-25          0 1903-08-26 #> 12            85 1983-03-14          1 1963-08-27"},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_diabetes.html","id":null,"dir":"Reference","previous_headings":"","what":"Extract diabetes status prior to an index date. — extract_diabetes","title":"Extract diabetes status prior to an index date. — extract_diabetes","text":"Extract diabetes status prior index date.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_diabetes.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Extract diabetes status prior to an index date. — extract_diabetes","text":"","code":"extract_diabetes(   cohort,   varname = NULL,   codelist.type1,   codelist.type2,   codelist.type1.vector,   codelist.type2.vector,   indexdt,   t = NULL,   t.varname = TRUE,   db.open = NULL,   db = NULL,   db.filepath = NULL,   out.save.disk = FALSE,   out.subdir = NULL,   out.filepath = NULL,   return.output = TRUE )"},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_diabetes.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Extract diabetes status prior to an index date. — extract_diabetes","text":"cohort Cohort extract age . varname Optional name variable output dataset. codelist.type1 Name codelist (stored hard disk \"codelists/analysis/\") type 1 diabetes query database . codelist.type2 Name codelist (stored hard disk \"codelists/analysis/\") type 2 diabetes query database . codelist.type1.vector Vector codes type 1 diabetes query database . codelist.type2.vector Vector codes type 2 diabetes query database . indexdt Name variable defines index date cohort. t Number days index date calculate variable. t.varname Whether add t varname. db.open open SQLite database connection created using RSQLite::dbConnect, queried. db Name SQLITE database hard disk (stored \"data/sql/\"), queried. db.filepath Full filepath SQLITE database hard disk, queried. .save.disk TRUE attempt save outputted data frame directory \"data/extraction/\". .subdir Sub-directory \"data/extraction/\" save outputted data frame . .filepath Full filepath filename save outputted data frame . return.output TRUE return outputted data frame R workspace.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_diabetes.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Extract diabetes status prior to an index date. — extract_diabetes","text":"data frame variable diabetes status.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_diabetes.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Extract diabetes status prior to an index date. — extract_diabetes","text":"individual found medical codes type 1 type 2 diabetes, returned value diabetes status type 1 diabetes. Full details algorithm extracting diabetes status given vignette: Details--algorithms--extracting-specific-variables. vignette can viewed running vignette(\"help\", package = \"rAURUM\"). Specifying db requires specific underlying directory structure. SQLite database must stored \"data/sql/\" relative working directory. SQLite database accessed db, connection opened closed query complete. true database accessed db.filepath. connection SQLite database can also opened manually using RSQLite::dbConnect, using object input parameter db.open. wards, connection must closed manually using RSQLite::dbDisconnect. db.open specified, take precedence db db.filepath. .save.disk = TRUE, data frame automatically written .rds file subdirectory \"data/extraction/\" working directory. directory structure must created advance. .subdir can used specify subdirectories within \"data/extraction/\". options use default naming convetion. can overwritten using .filepath manually specify location hard disk save. Alternatively, return data frame R workspace using return.output = TRUE save onto hard disk manually. Specifying non-vector type codelists requires specific underlying directory structure. codelist hard disk must stored \"codelists/analysis/\" relative working directory, must .csv file, contain column \"medcodeid\", \"prodcodeid\" \"ICD10\" depending chosen tab. input variables just name files (excluding suffix .csv). codelists can also read manually, supplied character vector. option take precedence codelists stored hard disk specified.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_diabetes.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Extract diabetes status prior to an index date. — extract_diabetes","text":"","code":"## Connect aurum_extract <- connect_database(tempfile(\"temp.sqlite\"))  ## Create SQLite database using cprd_extract cprd_extract(aurum_extract, filepath = system.file(\"aurum_data\", package = \"rAURUM\"), filetype = \"observation\", use.set = FALSE) #>    |                                                                               |                                                                      |   0%[1] \"Adding /home/runner/work/_temp/Library/rAURUM/aurum_data/aurum_allpatid_set1_extract_observation_001.txt 2024-08-02 16:56:23.145462\" #>    |                                                                               |=======================                                               |  33%[1] \"Adding /home/runner/work/_temp/Library/rAURUM/aurum_data/aurum_allpatid_set1_extract_observation_002.txt 2024-08-02 16:56:23.15821\" #>    |                                                                               |===============================================                       |  67%[1] \"Adding /home/runner/work/_temp/Library/rAURUM/aurum_data/aurum_allpatid_set1_extract_observation_003.txt 2024-08-02 16:56:23.16933\" #>    |                                                                               |======================================================================| 100%  ## Define cohort and add index date pat<-extract_cohort(system.file(\"aurum_data\", package = \"rAURUM\")) pat$indexdt <- as.Date(\"01/01/1955\", format = \"%d/%m/%Y\")  ## Extract diabetes prior to index date extract_diabetes(cohort = pat, codelist.type1.vector = \"498521000006119\", codelist.type2.vector = \"401539014\", indexdt = \"indexdt\", db.open = aurum_extract) #>    patid diabetes #> 1      1    Type1 #> 2      2   Absent #> 3      3   Absent #> 4      4   Absent #> 5      5    Type1 #> 6      6   Absent #> 7      7   Absent #> 8      8   Absent #> 9      9   Absent #> 10    10   Absent #> 11    11   Absent #> 12    12   Absent"},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_ho.html","id":null,"dir":"Reference","previous_headings":"","what":"Extract a 'history of' type variable — extract_ho","title":"Extract a 'history of' type variable — extract_ho","text":"Query RSQLite database return data frame 0/1 vector depending whether individual least one observation relevant code specified time period.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_ho.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Extract a 'history of' type variable — extract_ho","text":"","code":"extract_ho(   cohort,   varname = NULL,   codelist = NULL,   codelist.vector = NULL,   indexdt,   t = NULL,   t.varname = TRUE,   time.prev = Inf,   time.post = 0,   numobs = 1,   db.open = NULL,   db = NULL,   db.filepath = NULL,   tab = c(\"observation\", \"drugissue\", \"hes_primary\", \"death\"),   out.save.disk = FALSE,   out.subdir = NULL,   out.filepath = NULL,   return.output = TRUE )"},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_ho.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Extract a 'history of' type variable — extract_ho","text":"cohort Cohort individuals extract 'history ' variable . varname Name variable outputted data frame. codelist Name codelist (stored hard disk) query database . codelist.vector Vector codes query database . takes precedent codelist specified. indexdt Name variable cohort specifies index date. extracted variable calculated relative . t Number days indexdt extract variable. t.varname Whether alter variable name outputted data frame reflect t. time.prev Number days prior index date look codes. time.post Number days index date look codes. numobs Number obesrvations required return value 1. db.open open SQLite database connection created using RSQLite::dbConnect, queried. db Name SQLITE database hard disk (stored \"data/sql/\"), queried. db.filepath Full filepath SQLITE database hard disk, queried. tab Table name query SQLite database. .save.disk TRUE attempt save outputted data frame directory \"data/extraction/\". .subdir Sub-directory \"data/extraction/\" save outputted data frame . .filepath Full filepath filename save outputted data frame . return.output TRUE return outputted data frame R workspace.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_ho.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Extract a 'history of' type variable — extract_ho","text":"data frame 0/1 vector patid. 1 = presence code within specified time period.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_ho.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Extract a 'history of' type variable — extract_ho","text":"Specifying db requires specific underlying directory structure. SQLite database must stored \"data/sql/\" relative working directory. SQLite database accessed db, connection opened closed query complete. true database accessed db.filepath. connection SQLite database can also opened manually using RSQLite::dbConnect, using object input parameter db.open. wards, connection must closed manually using RSQLite::dbDisconnect. db.open specified, take precedence db db.filepath. .save.disk = TRUE, data frame automatically written .rds file subdirectory \"data/extraction/\" working directory. directory structure must created advance. .subdir can used specify subdirectories within \"data/extraction/\". options use default naming convention. can overwritten using .filepath manually specify location hard disk save. Alternatively, return data frame R workspace using return.output = TRUE save onto hard disk manually. Codelists can specified two ways. first read codelist R character vector specify argument codelist.vector. Codelists stored hard disk can also referred codelist argument, require specific underlying directory structure. codelist hard disk must stored directory called \"codelists/analysis/\" relative working directory. codelist must .csv file, contain column \"medcodeid\", \"prodcodeid\" \"ICD10\" depending input argument tab. input argument codelist just character string name files (excluding suffix '.csv'). codelist.vector option take precedence codelist argument specified.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_ho.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Extract a 'history of' type variable — extract_ho","text":"","code":"## Connect aurum_extract <- connect_database(tempfile(\"temp.sqlite\"))  ## Create SQLite database using cprd_extract cprd_extract(aurum_extract, filepath = system.file(\"aurum_data\", package = \"rAURUM\"), filetype = \"observation\", use.set = FALSE) #>    |                                                                               |                                                                      |   0%[1] \"Adding /home/runner/work/_temp/Library/rAURUM/aurum_data/aurum_allpatid_set1_extract_observation_001.txt 2024-08-02 16:56:23.400271\" #>    |                                                                               |=======================                                               |  33%[1] \"Adding /home/runner/work/_temp/Library/rAURUM/aurum_data/aurum_allpatid_set1_extract_observation_002.txt 2024-08-02 16:56:23.41343\" #>    |                                                                               |===============================================                       |  67%[1] \"Adding /home/runner/work/_temp/Library/rAURUM/aurum_data/aurum_allpatid_set1_extract_observation_003.txt 2024-08-02 16:56:23.425102\" #>    |                                                                               |======================================================================| 100%  ## Define cohort and add index date pat<-extract_cohort(system.file(\"aurum_data\", package = \"rAURUM\")) pat$indexdt <- as.Date(\"01/01/1955\", format = \"%d/%m/%Y\")  ## Extract a history of type variable prior to index date extract_ho(pat, codelist.vector = \"187341000000114\", indexdt = \"fup_start\", db.open = aurum_extract, tab = \"observation\", return.output = TRUE) #>    patid ho #> 1      1  0 #> 2      2  1 #> 3      3  0 #> 4      4  0 #> 5      5  0 #> 6      6  1 #> 7      7  0 #> 8      8  0 #> 9      9  0 #> 10    10  0 #> 11    11  0 #> 12    12  0"},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_impotence.html","id":null,"dir":"Reference","previous_headings":"","what":"Extract impotence status. — extract_impotence","title":"Extract impotence status. — extract_impotence","text":"Extract impotence status. requires either medical diagnosis, drug.numobs number prescriptions drug.time.prev number days prior index date.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_impotence.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Extract impotence status. — extract_impotence","text":"","code":"extract_impotence(   cohort,   varname = NULL,   codelist.med,   codelist.drug,   codelist.med.vector,   codelist.drug.vector,   indexdt,   t = NULL,   t.varname = TRUE,   drug.time.prev = Inf,   drug.numobs = 1,   db.open = NULL,   db = NULL,   db.filepath = NULL,   out.save.disk = FALSE,   out.subdir = NULL,   out.filepath = NULL,   return.output = TRUE )"},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_impotence.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Extract impotence status. — extract_impotence","text":"cohort Cohort extract age . varname Optional name variable output dataset. codelist.med Name codelist (stored hard disk \"codelists/analysis/\") medical diagnoses query database . codelist.drug Name codelist (stored hard disk \"codelists/analysis/\") prescriptions query database . codelist.med.vector Vector codes medical diagnoses query database . codelist.drug.vector Vector codes prescriptions query database . indexdt Name variable defines index date cohort. t Number days index date calculate variable. t.varname Whether add t varname. drug.time.prev Number days prior index date look prescriptions. drug.numobs Numbre prescriptions required time period indicate impotence. db.open open SQLite database connection created using RSQLite::dbConnect, queried. db Name SQLITE database hard disk (stored \"data/sql/\"), queried. db.filepath Full filepath SQLITE database hard disk, queried. .save.disk TRUE attempt save outputted data frame directory \"data/extraction/\". .subdir Sub-directory \"data/extraction/\" save outputted data frame . .filepath Full filepath filename save outputted data frame . return.output TRUE return outputted data frame R workspace.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_impotence.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Extract impotence status. — extract_impotence","text":"data frame variable impotence status.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_impotence.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Extract impotence status. — extract_impotence","text":"Specifying db requires specific underlying directory structure. SQLite database must stored \"data/sql/\" relative working directory. SQLite database accessed db, connection opened closed query complete. true database accessed db.filepath. connection SQLite database can also opened manually using RSQLite::dbConnect, using object input parameter db.open. wards, connection must closed manually using RSQLite::dbDisconnect. db.open specified, take precedence db db.filepath. .save.disk = TRUE, data frame automatically written .rds file subdirectory \"data/extraction/\" working directory. directory structure must created advance. .subdir can used specify subdirectories within \"data/extraction/\". options use default naming convetion. can overwritten using .filepath manually specify location hard disk save. Alternatively, return data frame R workspace using return.output = TRUE save onto hard disk manually. Specifying non-vector type codelists requires specific underlying directory structure. codelist hard disk must stored \"codelists/analysis/\" relative working directory, must .csv file, contain column \"medcodeid\", \"prodcodeid\" \"ICD10\" depending chosen tab. input variables just name files (excluding suffix .csv). codelists can also read manually, supplied character vector. option take precedence codelists stored hard disk specified.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_smoking.html","id":null,"dir":"Reference","previous_headings":"","what":"Extract smoking status prior to index date. — extract_smoking","title":"Extract smoking status prior to index date. — extract_smoking","text":"Extract smoking status prior index date.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_smoking.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Extract smoking status prior to index date. — extract_smoking","text":"","code":"extract_smoking(   cohort,   varname = NULL,   codelist.non,   codelist.ex,   codelist.light,   codelist.mod,   codelist.heavy,   codelist.non.vector,   codelist.ex.vector,   codelist.light.vector,   codelist.mod.vector,   codelist.heavy.vector,   indexdt,   t = NULL,   t.varname = TRUE,   db.open = NULL,   db = NULL,   db.filepath = NULL,   out.save.disk = FALSE,   out.subdir = NULL,   out.filepath = NULL,   return.output = TRUE )"},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_smoking.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Extract smoking status prior to index date. — extract_smoking","text":"cohort Cohort extract age . varname Optional name variable output dataset. codelist.non Name codelist (stored hard disk \"codelists/analysis/\") non-smoker query database . codelist.ex Name codelist (stored hard disk \"codelists/analysis/\") ex-smoker query database . codelist.light Name codelist (stored hard disk \"codelists/analysis/\") light smoker query database . codelist.mod Name codelist (stored hard disk \"codelists/analysis/\") moderate smoker query database . codelist.heavy Name codelist (stored hard disk \"codelists/analysis/\") heavy smoker query database . codelist.non.vector Vector codes non-smoker query database . codelist.ex.vector Vector codes ex-smoker query database . codelist.light.vector Vector codes light smoker query database . codelist.mod.vector Vector codes moderate smoker query database . codelist.heavy.vector Vector codes heavy smoker query database . indexdt Name variable defines index date cohort. t Number days index date calculate variable. t.varname Whether add t varname. db.open open SQLite database connection created using RSQLite::dbConnect, queried. db Name SQLITE database hard disk (stored \"data/sql/\"), queried. db.filepath Full filepath SQLITE database hard disk, queried. .save.disk TRUE attempt save outputted data frame directory \"data/extraction/\". .subdir Sub-directory \"data/extraction/\" save outputted data frame . .filepath Full filepath filename save outputted data frame . return.output TRUE return outputted data frame R workspace.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_smoking.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Extract smoking status prior to index date. — extract_smoking","text":"data frame variable smoking status.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_smoking.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Extract smoking status prior to index date. — extract_smoking","text":"Returns recent value smoking status. recently recorded observation smoking status non-smoker, individual history smoking identified medical record, outputted value smoking status ex-smoker. Full details algorithm extracting smoking status given vignette: Details--algorithms--extracting-specific-variables. vignette can viewed running vignette(\"help\", package = \"rAURUM\"). Specifying db requires specific underlying directory structure. SQLite database must stored \"data/sql/\" relative working directory. SQLite database accessed db, connection opened closed query complete. true database accessed db.filepath. connection SQLite database can also opened manually using RSQLite::dbConnect, using object input parameter db.open. wards, connection must closed manually using RSQLite::dbDisconnect. db.open specified, take precedence db db.filepath. .save.disk = TRUE, data frame automatically written .rds file subdirectory \"data/extraction/\" working directory. directory structure must created advance. .subdir can used specify subdirectories within \"data/extraction/\". options use default naming convetion. can overwritten using .filepath manually specify location hard disk save. Alternatively, return data frame R workspace using return.output = TRUE save onto hard disk manually. Specifying non-vector type codelists requires specific underlying directory structure. codelist hard disk must stored \"codelists/analysis/\" relative working directory, must .csv file, contain column \"medcodeid\", \"prodcodeid\" \"ICD10\" depending chosen tab. input variables just name files (excluding suffix .csv). codelists can also read manually, supplied character vector. option take precedence codelists stored hard disk specified. take recent smoking status record. individuals recent smoking status non-smoker, history smoking prior , individuals classed ex-smokers.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_smoking.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Extract smoking status prior to index date. — extract_smoking","text":"","code":"## Connect aurum_extract <- connect_database(tempfile(\"temp.sqlite\"))  ## Create SQLite database using cprd_extract cprd_extract(aurum_extract, filepath = system.file(\"aurum_data\", package = \"rAURUM\"), filetype = \"observation\", use.set = FALSE) #>    |                                                                               |                                                                      |   0%[1] \"Adding /home/runner/work/_temp/Library/rAURUM/aurum_data/aurum_allpatid_set1_extract_observation_001.txt 2024-08-02 16:56:23.777482\" #>    |                                                                               |=======================                                               |  33%[1] \"Adding /home/runner/work/_temp/Library/rAURUM/aurum_data/aurum_allpatid_set1_extract_observation_002.txt 2024-08-02 16:56:23.791263\" #>    |                                                                               |===============================================                       |  67%[1] \"Adding /home/runner/work/_temp/Library/rAURUM/aurum_data/aurum_allpatid_set1_extract_observation_003.txt 2024-08-02 16:56:23.803308\" #>    |                                                                               |======================================================================| 100%  ## Define cohort and add index date pat<-extract_cohort(system.file(\"aurum_data\", package = \"rAURUM\")) pat$indexdt <- as.Date(\"01/01/1955\", format = \"%d/%m/%Y\")  ## Extract smoking status prior to index date extract_smoking(cohort = pat, codelist.non.vector = \"498521000006119\", codelist.ex.vector = \"401539014\", codelist.light.vector = \"128011000000115\", codelist.mod.vector = \"380389013\", codelist.heavy.vector = \"13483031000006114\", indexdt = \"indexdt\", db.open = aurum_extract) #>    patid    smoking #> 1      1      Heavy #> 2     10       <NA> #> 3     11       <NA> #> 4     12       <NA> #> 5      2 Non-smoker #> 6      3       <NA> #> 7      4   Moderate #> 8      5  Ex-smoker #> 9      6   Moderate #> 10     7       <NA> #> 11     8       <NA> #> 12     9       <NA>"},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_test_data.html","id":null,"dir":"Reference","previous_headings":"","what":"Extract test data. — extract_test_data","title":"Extract test data. — extract_test_data","text":"Query RSQLite database return data frame containing recent test result meets specified criteria. Query RSQLite database return data frame containing recent test result meets specified criteria.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_test_data.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Extract test data. — extract_test_data","text":"","code":"extract_test_data(   cohort,   varname = NULL,   codelist = NULL,   codelist.vector = NULL,   indexdt,   t = NULL,   t.varname = TRUE,   time.prev = Inf,   time.post = Inf,   lower.bound = -Inf,   upper.bound = Inf,   db.open = NULL,   db = NULL,   db.filepath = NULL,   out.save.disk = FALSE,   out.subdir = NULL,   out.filepath = NULL,   return.output = FALSE )  extract_test_data(   cohort,   varname = NULL,   codelist = NULL,   codelist.vector = NULL,   indexdt,   t = NULL,   t.varname = TRUE,   time.prev = Inf,   time.post = Inf,   lower.bound = -Inf,   upper.bound = Inf,   db.open = NULL,   db = NULL,   db.filepath = NULL,   out.save.disk = FALSE,   out.subdir = NULL,   out.filepath = NULL,   return.output = FALSE )"},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_test_data.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Extract test data. — extract_test_data","text":"cohort Cohort individuals extract 'history ' variable . varname Name variable outputted data frame. codelist Name codelist (stored hard disk) query database . codelist.vector Vector codes query database . takes precedent codelist specified. indexdt Name variable cohort specifies index date. extracted variable calculated relative . t Number days indexdt extract variable. t.varname Whether alter variable name outputted data frame reflect t. time.prev Number days prior index date look codes. time.post Number days index date look codes. lower.bound Lower bound returned values. upper.bound Upper bound returned values. db.open open SQLite database connection created using RSQLite::dbConnect, queried. db Name SQLITE database hard disk (stored \"data/sql/\"), queried. db.filepath Full filepath SQLITE database hard disk, queried. .save.disk TRUE attempt save outputted data frame directory \"data/extraction/\". .subdir Sub-directory \"data/extraction/\" save outputted data frame . .filepath Full filepath filename save outputted data frame . return.output TRUE return outputted data frame R workspace.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_test_data.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Extract test data. — extract_test_data","text":"data frame containing recent test result meets required criteria. data frame containing test results meets required criteria.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_test_data.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Extract test data. — extract_test_data","text":"Specifying db requires specific underlying directory structure. SQLite database must stored \"data/sql/\" relative working directory. SQLite database accessed db, connection opened closed query complete. true database accessed db.filepath. connection SQLite database can also opened manually using RSQLite::dbConnect, using object input parameter db.open. wards, connection must closed manually using RSQLite::dbDisconnect. db.open specified, take precedence db db.filepath. .save.disk = TRUE, data frame automatically written .rds file subdirectory \"data/extraction/\" working directory. directory structure must created advance. .subdir can used specify subdirectories within \"data/extraction/\". options use default naming convetion. can overwritten using .filepath manually specify location hard disk save. Alternatively, return data frame R workspace using return.output = TRUE save onto hard disk manually. Codelists can specified two ways. first read codelist R character vector specify argument codelist.vector. Codelists stored hard disk can also referred codelist argument, require specific underlying directory structure. codelist hard disk must stored directory called \"codelists/analysis/\" relative working directory. codelist must .csv file, contain column \"medcodeid\", \"prodcodeid\" \"ICD10\" depending input argument tab. input argument codelist just character string name files (excluding suffix '.csv'). codelist.vector option take precedence codelist argument specified. Currently returns recent test result. updated return one recent test result specified. Specifying db requires specific underlying directory structure. SQLite database must stored \"data/sql/\" relative working directory. SQLite database accessed db, connection opened closed query complete. true database accessed db.filepath. connection SQLite database can also opened manually using RSQLite::dbConnect, using object input parameter db.open. wards, connection must closed manually using RSQLite::dbDisconnect. db.open specified, take precedence db db.filepath. .save.disk = TRUE, data frame automatically written .rds file subdirectory \"data/extraction/\" working directory. directory structure must created advance. .subdir can used specify subdirectories within \"data/extraction/\". options use default naming convetion. can overwritten using .filepath manually specify location hard disk save. Alternatively, return data frame R workspace using return.output = TRUE save onto hard disk manually. Codelists can specified two ways. first read codelist R character vector specify argument codelist.vector. Codelists stored hard disk can also referred codelist argument, require specific underlying directory structure. codelist hard disk must stored directory called \"codelists/analysis/\" relative working directory. codelist must .csv file, contain column \"medcodeid\", \"prodcodeid\" \"ICD10\" depending input argument tab. input argument codelist just character string name files (excluding suffix '.csv'). codelist.vector option take precedence codelist argument specified. Currently returns recent test result. updated return one recent test result specified.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_test_data.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Extract test data. — extract_test_data","text":"","code":"## Connect aurum_extract <- connect_database(tempfile(\"temp.sqlite\"))  ## Create SQLite database using cprd_extract cprd_extract(aurum_extract, filepath = system.file(\"aurum_data\", package = \"rAURUM\"), filetype = \"observation\", use.set = FALSE) #>    |                                                                               |                                                                      |   0%[1] \"Adding /home/runner/work/_temp/Library/rAURUM/aurum_data/aurum_allpatid_set1_extract_observation_001.txt 2024-08-02 16:56:24.121695\" #>    |                                                                               |=======================                                               |  33%[1] \"Adding /home/runner/work/_temp/Library/rAURUM/aurum_data/aurum_allpatid_set1_extract_observation_002.txt 2024-08-02 16:56:24.135371\" #>    |                                                                               |===============================================                       |  67%[1] \"Adding /home/runner/work/_temp/Library/rAURUM/aurum_data/aurum_allpatid_set1_extract_observation_003.txt 2024-08-02 16:56:24.147364\" #>    |                                                                               |======================================================================| 100%  ## Define cohort and add index date pat<-extract_cohort(system.file(\"aurum_data\", package = \"rAURUM\")) pat$indexdt <- as.Date(\"01/01/1955\", format = \"%d/%m/%Y\")  ## Extract most recent test value prior to index date extract_test_data(pat, codelist.vector = \"187341000000114\", indexdt = \"fup_start\", db.open = aurum_extract, time.prev = Inf, return.output = TRUE) #>    patid value numunitid       medcodeid obsdate #> 1      1    84        79 187341000000114   -5373 #> 2     10    NA        NA            <NA>      NA #> 3     11    NA        NA            <NA>      NA #> 4     12    NA        NA            <NA>      NA #> 5      2    46        92 187341000000114   -5769 #> 6      3    NA        NA            <NA>      NA #> 7      4    NA        NA            <NA>      NA #> 8      5    NA        NA            <NA>      NA #> 9      6    28        20 187341000000114  -14727 #> 10     7    NA        NA            <NA>      NA #> 11     8    NA        NA            <NA>      NA #> 12     9    NA        NA            <NA>      NA   ## Connect aurum_extract <- connect_database(tempfile(\"temp.sqlite\"))  ## Create SQLite database using cprd_extract cprd_extract(aurum_extract, filepath = system.file(\"aurum_data\", package = \"rAURUM\"), filetype = \"observation\", use.set = FALSE) #>    |                                                                               |                                                                      |   0%[1] \"Adding /home/runner/work/_temp/Library/rAURUM/aurum_data/aurum_allpatid_set1_extract_observation_001.txt 2024-08-02 16:56:24.18049\" #>    |                                                                               |=======================                                               |  33%[1] \"Adding /home/runner/work/_temp/Library/rAURUM/aurum_data/aurum_allpatid_set1_extract_observation_002.txt 2024-08-02 16:56:24.193669\" #>    |                                                                               |===============================================                       |  67%[1] \"Adding /home/runner/work/_temp/Library/rAURUM/aurum_data/aurum_allpatid_set1_extract_observation_003.txt 2024-08-02 16:56:24.205152\" #>    |                                                                               |======================================================================| 100%  ## Define cohort and add index date pat<-extract_cohort(system.file(\"aurum_data\", package = \"rAURUM\")) pat$indexdt <- as.Date(\"01/01/1955\", format = \"%d/%m/%Y\")  ## Extract most recent test value prior to index date extract_test_data(pat, codelist.vector = \"187341000000114\", indexdt = \"fup_start\", db.open = aurum_extract, time.prev = Inf, return.output = TRUE) #>    patid value numunitid       medcodeid obsdate #> 1      1    84        79 187341000000114   -5373 #> 2     10    NA        NA            <NA>      NA #> 3     11    NA        NA            <NA>      NA #> 4     12    NA        NA            <NA>      NA #> 5      2    46        92 187341000000114   -5769 #> 6      3    NA        NA            <NA>      NA #> 7      4    NA        NA            <NA>      NA #> 8      5    NA        NA            <NA>      NA #> 9      6    28        20 187341000000114  -14727 #> 10     7    NA        NA            <NA>      NA #> 11     8    NA        NA            <NA>      NA #> 12     9    NA        NA            <NA>      NA"},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_test_data_var.html","id":null,"dir":"Reference","previous_headings":"","what":"Extract standard deviation of all test data values over a specified time period relative to an index date. — extract_test_data_var","title":"Extract standard deviation of all test data values over a specified time period relative to an index date. — extract_test_data_var","text":"Extract standard deviation test data values specified time period relative index date.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_test_data_var.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Extract standard deviation of all test data values over a specified time period relative to an index date. — extract_test_data_var","text":"","code":"extract_test_data_var(   cohort,   varname = NULL,   codelist,   codelist.vector,   indexdt,   t = NULL,   t.varname = TRUE,   time.prev = 365.25 * 5,   time.post = 0,   lower.bound = -Inf,   upper.bound = Inf,   db.open = NULL,   db = NULL,   db.filepath = NULL,   out.save.disk = FALSE,   out.subdir = NULL,   out.filepath = NULL,   return.output = FALSE )"},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_test_data_var.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Extract standard deviation of all test data values over a specified time period relative to an index date. — extract_test_data_var","text":"cohort Cohort individuals extract 'history ' variable . varname Name variable outputted data frame. codelist Name codelist (stored hard disk) query database . codelist.vector Vector codes query database . takes precedent codelist specified. indexdt Name variable cohort specifies index date. extracted variable calculated relative . t Number days indexdt extract variable. t.varname Whether alter variable name outputted data frame reflect t. time.prev Number days prior index date look codes. time.post Number days index date look codes. lower.bound Lower bound returned values. upper.bound Upper bound returned values. db.open open SQLite database connection created using RSQLite::dbConnect, queried. db Name SQLITE database hard disk (stored \"data/sql/\"), queried. db.filepath Full filepath SQLITE database hard disk, queried. .save.disk TRUE attempt save outputted data frame directory \"data/extraction/\". .subdir Sub-directory \"data/extraction/\" save outputted data frame . .filepath Full filepath filename save outputted data frame . return.output TRUE return outputted data frame R workspace.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_test_data_var.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Extract standard deviation of all test data values over a specified time period relative to an index date. — extract_test_data_var","text":"data frame containing standard deviation test results.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_test_data_var.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Extract standard deviation of all test data values over a specified time period relative to an index date. — extract_test_data_var","text":"Specifying db requires specific underlying directory structure. SQLite database must stored \"data/sql/\" relative working directory. SQLite database accessed db, connection opened closed query complete. true database accessed db.filepath. connection SQLite database can also opened manually using RSQLite::dbConnect, using object input parameter db.open. wards, connection must closed manually using RSQLite::dbDisconnect. db.open specified, take precedence db db.filepath. .save.disk = TRUE, data frame automatically written .rds file subdirectory \"data/extraction/\" working directory. directory structure must created advance. .subdir can used specify subdirectories within \"data/extraction/\". options use default naming convetion. can overwritten using .filepath manually specify location hard disk save. Alternatively, return data frame R workspace using return.output = TRUE save onto hard disk manually. Currently returns recent test result. updated return one recent test result specified.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_test_data_var.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Extract standard deviation of all test data values over a specified time period relative to an index date. — extract_test_data_var","text":"","code":"## Connect aurum_extract <- connect_database(tempfile(\"temp.sqlite\"))  ## Create SQLite database using cprd_extract cprd_extract(aurum_extract, filepath = system.file(\"aurum_data\", package = \"rAURUM\"), filetype = \"observation\", use.set = FALSE) #>    |                                                                               |                                                                      |   0%[1] \"Adding /home/runner/work/_temp/Library/rAURUM/aurum_data/aurum_allpatid_set1_extract_observation_001.txt 2024-08-02 16:56:24.471503\" #>    |                                                                               |=======================                                               |  33%[1] \"Adding /home/runner/work/_temp/Library/rAURUM/aurum_data/aurum_allpatid_set1_extract_observation_002.txt 2024-08-02 16:56:24.489385\" #>    |                                                                               |===============================================                       |  67%[1] \"Adding /home/runner/work/_temp/Library/rAURUM/aurum_data/aurum_allpatid_set1_extract_observation_003.txt 2024-08-02 16:56:24.50059\" #>    |                                                                               |======================================================================| 100%  ## Define cohort and add index date pat<-extract_cohort(system.file(\"aurum_data\", package = \"rAURUM\")) pat$indexdt <- as.Date(\"01/01/1955\", format = \"%d/%m/%Y\")  ## Extract standard deviation of previous test scores prior to index date extract_test_data_var(pat, codelist.vector = \"187341000000114\", indexdt = \"fup_start\", db.open = aurum_extract, time.prev = Inf, return.output = TRUE) #>    patid value_var #> 1      1        NA #> 2     10        NA #> 3     11        NA #> 4     12        NA #> 5      2        NA #> 6      3        NA #> 7      4        NA #> 8      5        NA #> 9      6        NA #> 10     7        NA #> 11     8        NA #> 12     9        NA"},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_test_recent.html","id":null,"dir":"Reference","previous_headings":"","what":"Extract test data. — extract_test_recent","title":"Extract test data. — extract_test_recent","text":"Query RSQLite database return data frame containing recent test result meets specified criteria.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_test_recent.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Extract test data. — extract_test_recent","text":"","code":"extract_test_recent(   cohort,   varname = NULL,   codelist = NULL,   codelist.vector = NULL,   indexdt,   t = NULL,   t.varname = TRUE,   time.prev = 365.25 * 5,   time.post = 0,   lower.bound = -Inf,   upper.bound = Inf,   db.open = NULL,   db = NULL,   db.filepath = NULL,   out.save.disk = FALSE,   out.subdir = NULL,   out.filepath = NULL,   return.output = FALSE )"},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_test_recent.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Extract test data. — extract_test_recent","text":"cohort Cohort individuals extract 'history ' variable . varname Name variable outputted data frame. codelist Name codelist (stored hard disk) query database . codelist.vector Vector codes query database . takes precedent codelist specified. indexdt Name variable cohort specifies index date. extracted variable calculated relative . t Number days indexdt extract variable. t.varname Whether alter variable name outputted data frame reflect t. time.prev Number days prior index date look codes. time.post Number days index date look codes. lower.bound Lower bound returned values. upper.bound Upper bound returned values. db.open open SQLite database connection created using RSQLite::dbConnect, queried. db Name SQLITE database hard disk (stored \"data/sql/\"), queried. db.filepath Full filepath SQLITE database hard disk, queried. .save.disk TRUE attempt save outputted data frame directory \"data/extraction/\". .subdir Sub-directory \"data/extraction/\" save outputted data frame . .filepath Full filepath filename save outputted data frame . return.output TRUE return outputted data frame R workspace.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_test_recent.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Extract test data. — extract_test_recent","text":"data frame containing recent test result meets required criteria.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_test_recent.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Extract test data. — extract_test_recent","text":"Specifying db requires specific underlying directory structure. SQLite database must stored \"data/sql/\" relative working directory. SQLite database accessed db, connection opened closed query complete. true database accessed db.filepath. connection SQLite database can also opened manually using RSQLite::dbConnect, using object input parameter db.open. wards, connection must closed manually using RSQLite::dbDisconnect. db.open specified, take precedence db db.filepath. .save.disk = TRUE, data frame automatically written .rds file subdirectory \"data/extraction/\" working directory. directory structure must created advance. .subdir can used specify subdirectories within \"data/extraction/\". options use default naming convetion. can overwritten using .filepath manually specify location hard disk save. Alternatively, return data frame R workspace using return.output = TRUE save onto hard disk manually. Codelists can specified two ways. first read codelist R character vector specify argument codelist.vector. Codelists stored hard disk can also referred codelist argument, require specific underlying directory structure. codelist hard disk must stored directory called \"codelists/analysis/\" relative working directory. codelist must .csv file, contain column \"medcodeid\", \"prodcodeid\" \"ICD10\" depending input argument tab. input argument codelist just character string name files (excluding suffix '.csv'). codelist.vector option take precedence codelist argument specified. Currently returns recent test result. updated return one recent test result specified.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_test_recent.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Extract test data. — extract_test_recent","text":"","code":"## Connect aurum_extract <- connect_database(tempfile(\"temp.sqlite\"))  ## Create SQLite database using cprd_extract cprd_extract(aurum_extract, filepath = system.file(\"aurum_data\", package = \"rAURUM\"), filetype = \"observation\", use.set = FALSE) #>    |                                                                               |                                                                      |   0%[1] \"Adding /home/runner/work/_temp/Library/rAURUM/aurum_data/aurum_allpatid_set1_extract_observation_001.txt 2024-08-02 16:56:24.725218\" #>    |                                                                               |=======================                                               |  33%[1] \"Adding /home/runner/work/_temp/Library/rAURUM/aurum_data/aurum_allpatid_set1_extract_observation_002.txt 2024-08-02 16:56:24.744432\" #>    |                                                                               |===============================================                       |  67%[1] \"Adding /home/runner/work/_temp/Library/rAURUM/aurum_data/aurum_allpatid_set1_extract_observation_003.txt 2024-08-02 16:56:24.760948\" #>    |                                                                               |======================================================================| 100%  ## Define cohort and add index date pat<-extract_cohort(system.file(\"aurum_data\", package = \"rAURUM\")) pat$indexdt <- as.Date(\"01/01/1955\", format = \"%d/%m/%Y\")  ## Extract most recent test value prior to index date extract_test_data(pat, codelist.vector = \"187341000000114\", indexdt = \"fup_start\", db.open = aurum_extract, time.prev = Inf, return.output = TRUE) #>    patid value numunitid       medcodeid obsdate #> 1      1    84        79 187341000000114   -5373 #> 2     10    NA        NA            <NA>      NA #> 3     11    NA        NA            <NA>      NA #> 4     12    NA        NA            <NA>      NA #> 5      2    46        92 187341000000114   -5769 #> 6      3    NA        NA            <NA>      NA #> 7      4    NA        NA            <NA>      NA #> 8      5    NA        NA            <NA>      NA #> 9      6    28        20 187341000000114  -14727 #> 10     7    NA        NA            <NA>      NA #> 11     8    NA        NA            <NA>      NA #> 12     9    NA        NA            <NA>      NA"},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_time_until.html","id":null,"dir":"Reference","previous_headings":"","what":"Extract a 'time until' type variable — extract_time_until","title":"Extract a 'time until' type variable — extract_time_until","text":"Query RSQLite database data frame time first code interest censoring, event/censoring indicator.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_time_until.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Extract a 'time until' type variable — extract_time_until","text":"","code":"extract_time_until(   cohort,   varname.time = NULL,   varname.indicator = NULL,   codelist = NULL,   codelist.vector = NULL,   indexdt,   censdt,   censdt.lag = 0,   t = NULL,   t.varname = TRUE,   db.open = NULL,   db = NULL,   db.filepath = NULL,   tab = c(\"observation\", \"drugissue\", \"hes_primary\", \"death\"),   out.save.disk = FALSE,   out.subdir = NULL,   out.filepath = NULL,   return.output = FALSE )"},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_time_until.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Extract a 'time until' type variable — extract_time_until","text":"cohort Cohort individuals extract 'history ' variable . varname.time Name time variable outputted data frame. varname.indicator Name event/censoring indicator outputted data frame. codelist Name codelist (stored hard disk) query database . codelist.vector Vector codes query database . takes precedent codelist specified. indexdt Name variable cohort specifies index date. extracted variable calculated relative . censdt Name variable cohort specifies censoring date. censdt.lag Number days censoring events still considered, account delays recording. t Number days indexdt extract variable. t.varname Whether alter variable name outputted data frame reflect t. db.open open SQLite database connection created using RSQLite::dbConnect, queried. db Name SQLITE database hard disk (stored \"data/sql/\"), queried. db.filepath Full filepath SQLITE database hard disk, queried. tab Table name query SQLite database. .save.disk TRUE attempt save outputted data frame directory \"data/extraction/\". .subdir Sub-directory \"data/extraction/\" save outputted data frame . .filepath Full filepath filename save outputted data frame . return.output TRUE return outputted data frame R workspace.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_time_until.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Extract a 'time until' type variable — extract_time_until","text":"data frame variable patid, variable containing time event/censoring, variable containing event/censoring indicator.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_time_until.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Extract a 'time until' type variable — extract_time_until","text":"Specifying db requires specific underlying directory structure. SQLite database must stored \"data/sql/\" relative working directory. SQLite database accessed db, connection opened closed query complete. true database accessed db.filepath. connection SQLite database can also opened manually using RSQLite::dbConnect, using object input parameter db.open. wards, connection must closed manually using RSQLite::dbDisconnect. db.open specified, take precedence db db.filepath. .save.disk = TRUE, data frame automatically written .rds file subdirectory \"data/extraction/\" working directory. directory structure must created advance. .subdir can used specify subdirectories within \"data/extraction/\". options use default naming convetion. can overwritten using .filepath manually specify location hard disk save. Alternatively, return data frame R workspace using return.output = TRUE save onto hard disk manually. Codelists can specified two ways. first read codelist R character vector specify argument codelist.vector. Codelists stored hard disk can also referred codelist argument, require specific underlying directory structure. codelist hard disk must stored directory called \"codelists/analysis/\" relative working directory. codelist must .csv file, contain column \"medcodeid\", \"prodcodeid\" \"ICD10\" depending input argument tab. input argument codelist just character string name files (excluding suffix '.csv'). codelist.vector option take precedence codelist argument specified. time event time censored, considered event (var_indicator = 1) dtcens.lag > 0, time event interest time minimum event interest, date censoring.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_time_until.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Extract a 'time until' type variable — extract_time_until","text":"","code":"## Connect aurum_extract <- connect_database(tempfile(\"temp.sqlite\"))  ## Create SQLite database using cprd_extract cprd_extract(aurum_extract, filepath = system.file(\"aurum_data\", package = \"rAURUM\"), filetype = \"observation\", use.set = FALSE) #>    |                                                                               |                                                                      |   0%[1] \"Adding /home/runner/work/_temp/Library/rAURUM/aurum_data/aurum_allpatid_set1_extract_observation_001.txt 2024-08-02 16:56:25.128029\" #>    |                                                                               |=======================                                               |  33%[1] \"Adding /home/runner/work/_temp/Library/rAURUM/aurum_data/aurum_allpatid_set1_extract_observation_002.txt 2024-08-02 16:56:25.141374\" #>    |                                                                               |===============================================                       |  67%[1] \"Adding /home/runner/work/_temp/Library/rAURUM/aurum_data/aurum_allpatid_set1_extract_observation_003.txt 2024-08-02 16:56:25.152868\" #>    |                                                                               |======================================================================| 100%  ## Define cohort and add index date and censoring date pat<-extract_cohort(system.file(\"aurum_data\", package = \"rAURUM\")) pat$indexdt <- as.Date(\"01/01/1955\", format = \"%d/%m/%Y\") pat$fup_end <- as.Date(\"01/01/2000\", format = \"%d/%m/%Y\")  ## Extract time until event/censoring extract_time_until(pat, codelist.vector = \"187341000000114\", indexdt = \"fup_start\", censdt = \"fup_end\", db.open = aurum_extract, tab = \"observation\", return.output = TRUE) #>    patid var_time var_indicator #> 1      1      106             1 #> 2     10    16436             0 #> 3     11    16436             0 #> 4     12    16436             0 #> 5      2    16436             0 #> 6      3    16436             0 #> 7      4    16436             0 #> 8      5    16436             0 #> 9      6    16436             0 #> 10     7    16436             0 #> 11     8    16436             0 #> 12     9    16436             0"},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_txt_char.html","id":null,"dir":"Reference","previous_headings":"","what":"Read in txt file with all colClasses = ","title":"Read in txt file with all colClasses = ","text":"Read txt file colClasses = \"character\"","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_txt_char.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Read in txt file with all colClasses = ","text":"","code":"extract_txt_char(filepath, ..., select = NULL)"},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_txt_char.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Read in txt file with all colClasses = ","text":"filepath File path raw .txt file ... Arguments pass onto utils::read.table select Character vector variable names select","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_txt_cons.html","id":null,"dir":"Reference","previous_headings":"","what":"Read in raw .txt consultation file — extract_txt_cons","title":"Read in raw .txt consultation file — extract_txt_cons","text":"Read raw .txt consultation file","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_txt_cons.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Read in raw .txt consultation file — extract_txt_cons","text":"","code":"extract_txt_cons(filepath, ..., select = NULL)"},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_txt_cons.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Read in raw .txt consultation file — extract_txt_cons","text":"filepath File path raw .txt file ... Arguments pass onto utils::read.table select Character vector variable names select","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_txt_death.html","id":null,"dir":"Reference","previous_headings":"","what":"Read in raw ONS death data file — extract_txt_death","title":"Read in raw ONS death data file — extract_txt_death","text":"Read raw ONS death data file","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_txt_death.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Read in raw ONS death data file — extract_txt_death","text":"","code":"extract_txt_death(filepath, ..., select = NULL)"},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_txt_death.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Read in raw ONS death data file — extract_txt_death","text":"filepath File path raw .txt file ... Arguments pass onto utils::read.table select Character vector variable names select","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_txt_drug.html","id":null,"dir":"Reference","previous_headings":"","what":"Read in raw .txt drugissue file — extract_txt_drug","title":"Read in raw .txt drugissue file — extract_txt_drug","text":"Read raw .txt drugissue file","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_txt_drug.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Read in raw .txt drugissue file — extract_txt_drug","text":"","code":"extract_txt_drug(filepath, ..., select = NULL)"},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_txt_drug.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Read in raw .txt drugissue file — extract_txt_drug","text":"filepath File path raw .txt file ... Arguments pass onto utils::read.table select Character vector variable names select","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_txt_hes_primary.html","id":null,"dir":"Reference","previous_headings":"","what":"Read in raw HES primary diagnoses file — extract_txt_hes_primary","title":"Read in raw HES primary diagnoses file — extract_txt_hes_primary","text":"Read raw HES primary diagnoses file","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_txt_hes_primary.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Read in raw HES primary diagnoses file — extract_txt_hes_primary","text":"","code":"extract_txt_hes_primary(filepath, ..., select = NULL)"},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_txt_hes_primary.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Read in raw HES primary diagnoses file — extract_txt_hes_primary","text":"filepath File path raw .txt file ... Arguments pass onto utils::read.table select Character vector variable names select","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_txt_linkage.html","id":null,"dir":"Reference","previous_headings":"","what":"Read in linkage eligibility file — extract_txt_linkage","title":"Read in linkage eligibility file — extract_txt_linkage","text":"Read linkage eligibility file","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_txt_linkage.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Read in linkage eligibility file — extract_txt_linkage","text":"","code":"extract_txt_linkage(filepath, ...)"},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_txt_linkage.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Read in linkage eligibility file — extract_txt_linkage","text":"filepath File path raw .txt file ... Arguments pass onto utils::read.table","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_txt_obs.html","id":null,"dir":"Reference","previous_headings":"","what":"Read in raw .txt observation file — extract_txt_obs","title":"Read in raw .txt observation file — extract_txt_obs","text":"Read raw .txt observation file","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_txt_obs.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Read in raw .txt observation file — extract_txt_obs","text":"","code":"extract_txt_obs(filepath, ..., select = NULL)"},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_txt_obs.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Read in raw .txt observation file — extract_txt_obs","text":"filepath File path raw .txt file ... Arguments pass onto utils::read.table select Character vector variable names select","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_txt_pat.html","id":null,"dir":"Reference","previous_headings":"","what":"Read in raw .txt patient file — extract_txt_pat","title":"Read in raw .txt patient file — extract_txt_pat","text":"Read raw .txt patient file","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_txt_pat.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Read in raw .txt patient file — extract_txt_pat","text":"","code":"extract_txt_pat(filepath, ..., set = FALSE)"},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_txt_pat.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Read in raw .txt patient file — extract_txt_pat","text":"filepath File path raw .txt file ... Arguments pass onto utils::read.table set TRUE create variable called set contain number comes word 'set' file name.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_txt_prob.html","id":null,"dir":"Reference","previous_headings":"","what":"Read in raw .txt problem file — extract_txt_prob","title":"Read in raw .txt problem file — extract_txt_prob","text":"Read raw .txt problem file","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_txt_prob.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Read in raw .txt problem file — extract_txt_prob","text":"","code":"extract_txt_prob(filepath, ..., select = NULL)"},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_txt_prob.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Read in raw .txt problem file — extract_txt_prob","text":"filepath File path raw .txt file ... Arguments pass onto utils::read.table select Character vector variable names select","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_txt_ref.html","id":null,"dir":"Reference","previous_headings":"","what":"Read in raw .txt referral file — extract_txt_ref","title":"Read in raw .txt referral file — extract_txt_ref","text":"Read raw .txt referral file","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_txt_ref.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Read in raw .txt referral file — extract_txt_ref","text":"","code":"extract_txt_ref(filepath, ..., select = NULL)"},{"path":"https://alexpate30.github.io/rAURUM/reference/extract_txt_ref.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Read in raw .txt referral file — extract_txt_ref","text":"filepath File path raw .txt file ... Arguments pass onto utils::read.table select Character vector variable names select","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/implement_output.html","id":null,"dir":"Reference","previous_headings":"","what":"Internal function to implement saving extracted variable to disk or returning into R workspace. — implement_output","title":"Internal function to implement saving extracted variable to disk or returning into R workspace. — implement_output","text":"save extracted variable disk .save.disk = TRUE. Note relies correct underlying structure directories. output extracted variable R workspace return.output = TRUE.","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/implement_output.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Internal function to implement saving extracted variable to disk or returning into R workspace. — implement_output","text":"","code":"implement_output(   variable.dat,   varname,   out.save.disk,   out.subdir,   out.filepath,   return.output )"},{"path":"https://alexpate30.github.io/rAURUM/reference/implement_output.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Internal function to implement saving extracted variable to disk or returning into R workspace. — implement_output","text":"variable.dat Dataset containing variable varname Name variable use filename .save.disk TRUE save output disk .subdir Sub-directory data/ save output .filepath Full fiilepath save dat onto return.output TRUE returns output R workspace","code":""},{"path":"https://alexpate30.github.io/rAURUM/reference/rAURUM-package.html","id":null,"dir":"Reference","previous_headings":"","what":"rAURUM: Extract and Manage CPRD Aurum Data and Create Analysis-Ready Datasets — rAURUM-package","title":"rAURUM: Extract and Manage CPRD Aurum Data and Create Analysis-Ready Datasets — rAURUM-package","text":"Simplify process converting raw CPRD Aurum data, stored large text files, 'analysis-ready' dataset can used statistical analyses. process somewhat difficult R, raw data large read R workspace. rAURUM utilises RSQLite create SQLite databases stored hard disk. queried extract required information cohort interest. processes follow closely rEHR package, see Springate et al., (2017) doi:10.1371/journal.pone.0171784 .","code":""},{"path":[]},{"path":"https://alexpate30.github.io/rAURUM/reference/rAURUM-package.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"rAURUM: Extract and Manage CPRD Aurum Data and Create Analysis-Ready Datasets — rAURUM-package","text":"Maintainer: Alexander Pate alexander.pate@manchester.ac.uk (ORCID) [copyright holder]","code":""},{"path":"https://alexpate30.github.io/rAURUM/news/index.html","id":"raurum-development-version","dir":"Changelog","previous_headings":"","what":"rAURUM (development version)","title":"rAURUM (development version)","text":"Created NEWS.md file.","code":""},{"path":"https://alexpate30.github.io/rAURUM/news/index.html","id":"raurum-0009000","dir":"Changelog","previous_headings":"","what":"rAURUM 0.0.0.9000","title":"rAURUM 0.0.0.9000","text":"Preparing CRAN submission.","code":""}]
